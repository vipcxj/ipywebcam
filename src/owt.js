/*
 * Intel WebRTC SDK version 5.1.0
 * Copyright (c) 2023 Intel <http://webrtc.intel.com>
 * Homepage: http://webrtc.intel.com
 */
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Owt=e()}(function(){return function n(i,a,o){function s(t,e){if(!a[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=a[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,n,i,a,o)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,r){t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},t.exports.__esModule=!0,t.exports.default=t.exports},{}],2:[function(e,t,r){t.exports=function(e){if(Array.isArray(e))return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],3:[function(e,t,r){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],4:[function(e,t,r){function u(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}t.exports=function(s){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=s.apply(e,o);function i(e){u(n,t,r,i,a,"next",e)}function a(e){u(n,t,r,i,a,"throw",e)}i(void 0)})}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],5:[function(e,t,r){t.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],6:[function(e,n,t){var i=e("./setPrototypeOf.js"),a=e("./isNativeReflectConstruct.js");function o(e,t,r){return a()?n.exports=o=Reflect.construct.bind():n.exports=o=function(e,t,r){var n=[null];n.push.apply(n,t);t=new(Function.bind.apply(e,n));return r&&i(t,r.prototype),t},n.exports.__esModule=!0,n.exports.default=n.exports,o.apply(null,arguments)}n.exports=o,n.exports.__esModule=!0,n.exports.default=n.exports},{"./isNativeReflectConstruct.js":12,"./setPrototypeOf.js":17}],7:[function(e,t,r){var i=e("./toPropertyKey.js");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}t.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":20}],8:[function(e,t,r){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],9:[function(e,t,r){var n=e("./setPrototypeOf.js");t.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./setPrototypeOf.js":17}],10:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],11:[function(e,t,r){t.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],12:[function(e,t,r){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],13:[function(e,t,r){t.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],14:[function(e,t,r){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],15:[function(e,t,r){var n=e("./typeof.js").default,i=e("./assertThisInitialized.js");t.exports=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./assertThisInitialized.js":3,"./typeof.js":21}],16:[function(e,C,t){var k=e("./typeof.js").default;function r(){"use strict";C.exports=function(){return o},C.exports.__esModule=!0,C.exports.default=C.exports;var o={},e=Object.prototype,u=e.hasOwnProperty,c=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i,a,o,s,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype),n=new S(n||[]);return c(t,"_invoke",{value:(i=e,a=r,o=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return w()}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;n=l(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,d;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}(r,o);if(r){if(r===d)continue;return r}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";r=l(i,a,o);if("normal"===r.type){if(s=o.done?"completed":"suspendedYield",r.arg===d)continue;return{value:r.arg,done:o.done}}"throw"===r.type&&(s="completed",o.method="throw",o.arg=r.arg)}})}),t}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var d={};function f(){}function p(){}function h(){}var t={},b=(a(t,n,function(){return this}),Object.getPrototypeOf),b=b&&b(b(P([]))),m=(b&&b!==e&&u.call(b,n)&&(t=b),h.prototype=f.prototype=Object.create(t));function v(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function g(o,s){var t;c(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var a,e=l(o[e],o,r);if("throw"!==e.type)return(r=(a=e.arg).value)&&"object"==k(r)&&u.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){a.value=e,n(a)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function P(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:w}}function w(){return{value:void 0,done:!0}}return c(m,"constructor",{value:p.prototype=h,configurable:!0}),c(h,"constructor",{value:p,configurable:!0}),p.displayName=a(h,i,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},o.awrap=function(e){return{__await:e}},v(g.prototype),a(g.prototype,r,function(){return this}),o.AsyncIterator=g,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new g(s(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},v(m),a(m,i,"Generator"),a(m,n,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=P,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return a.type="throw",a.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],a=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var o=u.call(i,"catchLoc"),s=u.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var a=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,_(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},o}C.exports=r,C.exports.__esModule=!0,C.exports.default=C.exports},{"./typeof.js":21}],17:[function(e,r,t){function n(e,t){return r.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r.exports.__esModule=!0,r.exports.default=r.exports,n(e,t)}r.exports=n,r.exports.__esModule=!0,r.exports.default=r.exports},{}],18:[function(e,t,r){var n=e("./arrayWithHoles.js"),i=e("./iterableToArrayLimit.js"),a=e("./unsupportedIterableToArray.js"),o=e("./nonIterableRest.js");t.exports=function(e,t){return n(e)||i(e,t)||a(e,t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},{"./arrayWithHoles.js":2,"./iterableToArrayLimit.js":13,"./nonIterableRest.js":14,"./unsupportedIterableToArray.js":22}],19:[function(e,t,r){var n=e("./typeof.js").default;t.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":21}],20:[function(e,t,r){var n=e("./typeof.js").default,i=e("./toPrimitive.js");t.exports=function(e){return e=i(e,"string"),"symbol"===n(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":19,"./typeof.js":21}],21:[function(e,t,r){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],22:[function(e,t,r){var n=e("./arrayLikeToArray.js");t.exports=function(e,t){var r;if(e)return"string"==typeof e?n(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0},t.exports.__esModule=!0,t.exports.default=t.exports},{"./arrayLikeToArray.js":1}],23:[function(e,t,r){var n=e("./getPrototypeOf.js"),i=e("./setPrototypeOf.js"),a=e("./isNativeFunction.js"),o=e("./construct.js");function s(e){var r="function"==typeof Map?new Map:void 0;return t.exports=s=function(e){if(null===e||!a(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return o(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports,s(e)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{"./construct.js":6,"./getPrototypeOf.js":8,"./isNativeFunction.js":11,"./setPrototypeOf.js":17}],24:[function(t,e,r){t=t("../helpers/regeneratorRuntime")();e.exports=t;try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},{"../helpers/regeneratorRuntime":16}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Base64=void 0;var n=function(){for(var t,r,i=-1,a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n=[],e=0;e<a.length;e+=1)n[a[e]]=e;function o(e){t=e,r=0}function s(){var e;return!t||r>=t.length?i:(e=255&t.charCodeAt(r),r+=1,e)}function u(){if(!t)return i;for(;;){if(r>=t.length)return i;var e=t.charAt(r);if(r+=1,n[e])return n[e];if("A"===e)return 0}}function c(e){return e="%"+(e=1===(e=e.toString(16)).length?"0"+e:e),unescape(e)}return{encodeBase64:function(e){o(e),t="";for(var t,r=new Array(3),n=!1;!n&&(r[0]=s())!==i;)r[1]=s(),r[2]=s(),t+=a[r[0]>>2],r[1]!==i?(t+=a[r[0]<<4&48|r[1]>>4],r[2]!==i?t=(t+=a[r[1]<<2&60|r[2]>>6])+a[63&r[2]]:(t=t+a[r[1]<<2&60]+"=",n=!0)):(t=t+a[r[0]<<4&48]+"==",n=!0);return t},decodeBase64:function(e){o(e),t="";for(var t,r=new Array(4),n=!1;!n&&(r[0]=u())!==i&&(r[1]=u())!==i;)r[2]=u(),r[3]=u(),t+=c(r[0]<<2&255|r[1]>>4),r[2]!==i&&(t+=c(r[1]<<4&255|r[2]>>2),r[3]!==i)?t+=c(r[2]<<6&255|r[3]):n=!0;return t}}}();r.Base64=n},{}],26:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.VideoEncodingParameters=r.VideoCodecParameters=r.VideoCodec=r.AudioEncodingParameters=r.AudioCodecParameters=r.AudioCodec=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),n=(r.AudioCodec={PCMU:"pcmu",PCMA:"pcma",OPUS:"opus",G722:"g722",ISAC:"iSAC",ILBC:"iLBC",AAC:"aac",AC3:"ac3",NELLYMOSER:"nellymoser"},(0,i.default)(function e(t,r,n){(0,a.default)(this,e),this.name=t,this.channelCount=r,this.clockRate=n})),e=(r.AudioCodecParameters=n,(0,i.default)(function e(t,r){(0,a.default)(this,e),this.codec=t,this.maxBitrate=r})),n=(r.AudioEncodingParameters=e,r.VideoCodec={VP8:"vp8",VP9:"vp9",H264:"h264",H265:"h265",AV1:"av1",AV1X:"av1x"},(0,i.default)(function e(t,r){(0,a.default)(this,e),this.name=t,this.profile=r})),e=(r.VideoCodecParameters=n,(0,i.default)(function e(t,r){(0,a.default)(this,e),this.codec=t,this.maxBitrate=r}));r.VideoEncodingParameters=e},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10}],27:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.OwtEvent=r.MuteEvent=r.MessageEvent=r.EventDispatcher=r.ErrorEvent=void 0,n(e("@babel/runtime/helpers/inherits"))),a=n(e("@babel/runtime/helpers/possibleConstructorReturn")),o=n(e("@babel/runtime/helpers/getPrototypeOf")),s=n(e("@babel/runtime/helpers/createClass")),u=n(e("@babel/runtime/helpers/classCallCheck"));function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,o.default)(r);return e=n?(e=(0,o.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,a.default)(this,e)}}r.EventDispatcher=function(){var r={dispatcher:{}};r.dispatcher.eventListeners={},this.addEventListener=function(e,t){void 0===r.dispatcher.eventListeners[e]&&(r.dispatcher.eventListeners[e]=[]),r.dispatcher.eventListeners[e].push(t)},this.removeEventListener=function(e,t){r.dispatcher.eventListeners[e]&&-1!==(t=r.dispatcher.eventListeners[e].indexOf(t))&&r.dispatcher.eventListeners[e].splice(t,1)},this.clearEventListener=function(e){r.dispatcher.eventListeners[e]=[]},this.dispatchEvent=function(t){r.dispatcher.eventListeners[t.type]&&r.dispatcher.eventListeners[t.type].map(function(e){e(t)})}};var l=(0,s.default)(function e(t){(0,u.default)(this,e),this.type=t}),n=(r.OwtEvent=l,function(){(0,i.default)(n,l);var r=c(n);function n(e,t){return(0,u.default)(this,n),(e=r.call(this,e)).origin=t.origin,e.message=t.message,e.to=t.to,e}return(0,s.default)(n)}()),e=(r.MessageEvent=n,function(){(0,i.default)(n,l);var r=c(n);function n(e,t){return(0,u.default)(this,n),(e=r.call(this,e)).error=t.error,e}return(0,s.default)(n)}()),n=(r.ErrorEvent=e,function(){(0,i.default)(n,l);var r=c(n);function n(e,t){return(0,u.default)(this,n),(e=r.call(this,e)).kind=t.kind,e}return(0,s.default)(n)}());r.MuteEvent=n},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./mediastream-factory.js"),i=(Object.keys(n).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})}),e("./stream.js")),a=(Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}),e("./mediaformat.js")),o=(Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})}),e("./transport.js"));Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},{"./mediaformat.js":30,"./mediastream-factory.js":31,"./stream.js":34,"./transport.js":35}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;n={DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,log:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=window.console).log.apply(e,[(new Date).toISOString()].concat(r))}},s(4),n.setLogLevel=s;var n,i=n;function a(){}function o(i){return"function"==typeof window.console[i]?function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=window.console)[i].apply(e,[(new Date).toISOString()].concat(r))}:n.log}function s(e){n.debug=e<=0?o("debug"):a,n.trace=e<=1?o("trace"):a,n.info=e<=2?o("info"):a,n.warning=e<=3?o("warn"):a,n.error=e<=4?o("error"):a}r.default=i},{}],30:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.VideoSourceInfo=r.TrackKind=r.Resolution=r.AudioSourceInfo=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),n=(r.AudioSourceInfo={MIC:"mic",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},r.VideoSourceInfo={CAMERA:"camera",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},r.TrackKind={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"av"},(0,i.default)(function e(t,r){(0,a.default)(this,e),this.width=t,this.height=r}));r.Resolution=n},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10}],31:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.VideoTrackConstraints=r.StreamConstraints=r.MediaStreamFactory=r.AudioTrackConstraints=void 0,n(e("@babel/runtime/helpers/typeof"))),a=n(e("@babel/runtime/helpers/createClass")),s=n(e("@babel/runtime/helpers/classCallCheck")),u=d(e("./utils.js")),c=d(e("./mediaformat.js"));function l(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(l=function(e){return e?r:t})(e))}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=l(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}r.AudioTrackConstraints=(0,a.default)(function e(t){if((0,s.default)(this,e),!Object.values(c.AudioSourceInfo).some(function(e){return e===t}))throw new TypeError("Invalid source.");this.source=t,this.deviceId=void 0});n=(0,a.default)(function e(t){if((0,s.default)(this,e),!Object.values(c.VideoSourceInfo).some(function(e){return e===t}))throw new TypeError("Invalid source.");this.source=t,this.deviceId=void 0,this.resolution=void 0,this.frameRate=void 0}),r.VideoTrackConstraints=n,e=(0,a.default)(function e(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];(0,s.default)(this,e),this.audio=t,this.video=r});function f(e){return"object"===(0,i.default)(e.video)&&e.video.source===c.VideoSourceInfo.SCREENCAST}r.StreamConstraints=e;n=function(){function e(){(0,s.default)(this,e)}return(0,a.default)(e,null,[{key:"createMediaStream",value:function(e){var t;return"object"!==(0,i.default)(e)||!e.audio&&!e.video?Promise.reject(new TypeError("Invalid constrains")):f(e)||"object"!==(0,i.default)(e.audio)||e.audio.source!==c.AudioSourceInfo.SCREENCAST?f(e)&&"object"===(0,i.default)(e.audio)&&e.audio.source!==c.AudioSourceInfo.SCREENCAST?Promise.reject(new TypeError("Cannot capture video from screen cast while capture audio from other source.")):e.audio||e.video?(t=Object.create({}),"object"===(0,i.default)(e.audio)&&e.audio.source===c.AudioSourceInfo.MIC?(t.audio=Object.create({}),u.isEdge()?t.audio.deviceId=e.audio.deviceId:t.audio.deviceId={exact:e.audio.deviceId}):e.audio.source===c.AudioSourceInfo.SCREENCAST?t.audio=!0:t.audio=e.audio,"object"===(0,i.default)(e.video)?(t.video=Object.create({}),"number"==typeof e.video.frameRate&&(t.video.frameRate=e.video.frameRate),e.video.resolution&&e.video.resolution.width&&e.video.resolution.height&&(e.video.source===c.VideoSourceInfo.SCREENCAST?(t.video.width=e.video.resolution.width,t.video.height=e.video.resolution.height):(t.video.width=Object.create({}),t.video.width.exact=e.video.resolution.width,t.video.height=Object.create({}),t.video.height.exact=e.video.resolution.height)),"string"==typeof e.video.deviceId&&(t.video.deviceId={exact:e.video.deviceId}),u.isFirefox()&&e.video.source===c.VideoSourceInfo.SCREENCAST&&(t.video.mediaSource="screen")):t.video=e.video,f(e)?navigator.mediaDevices.getDisplayMedia(t):navigator.mediaDevices.getUserMedia(t)):Promise.reject(new TypeError("At least one of audio and video must be requested.")):Promise.reject(new TypeError("Cannot share screen without video."))}}]),e}();r.MediaStreamFactory=n},{"./mediaformat.js":30,"./utils.js":36,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/typeof":21}],32:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),c=(Object.defineProperty(r,"__esModule",{value:!0}),r.VideoPublicationSettings=r.PublishOptions=r.PublicationSettings=r.Publication=r.AudioPublicationSettings=void 0,n(e("@babel/runtime/helpers/assertThisInitialized"))),i=n(e("@babel/runtime/helpers/inherits")),a=n(e("@babel/runtime/helpers/possibleConstructorReturn")),s=n(e("@babel/runtime/helpers/getPrototypeOf")),l=n(e("@babel/runtime/helpers/createClass")),d=n(e("@babel/runtime/helpers/classCallCheck")),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=u(t);if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var a;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("./utils.js")),n=e("../base/event.js");function u(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(u=function(e){return e?r:t})(e))}function p(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(r);return e=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,a.default)(this,e)}}r.AudioPublicationSettings=(0,l.default)(function e(t){(0,d.default)(this,e),this.codec=t});e=(0,l.default)(function e(t,r,n,i,a,o){(0,d.default)(this,e),this.codec=t,this.resolution=r,this.frameRate=n,this.bitrate=i,this.keyFrameInterval=a,this.rid=o}),r.VideoPublicationSettings=e,e=(0,l.default)(function e(t,r){(0,d.default)(this,e),this.audio=t,this.video=r}),r.PublicationSettings=e,e=function(e){(0,i.default)(u,e);var s=p(u);function u(e,t,r,n,i,a){var o;return(0,d.default)(this,u),o=s.call(this),Object.defineProperty((0,c.default)(o),"id",{configurable:!1,writable:!1,value:e||f.createUuid()}),Object.defineProperty((0,c.default)(o),"transport",{configurable:!1,writable:!1,value:t}),o.stop=r,o.getStats=n,o.mute=i,o.unmute=a,o}return(0,l.default)(u)}(n.EventDispatcher),r.Publication=e,n=(0,l.default)(function e(t,r,n){(0,d.default)(this,e),this.audio=t,this.video=r,this.transport=n});r.PublishOptions=n},{"../base/event.js":27,"./utils.js":36,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/typeof":21}],33:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=(Object.defineProperty(r,"__esModule",{value:!0}),r.addLegacySimulcast=function(e,t,n,r){if(n&&1<n){var i=e.split("\r\n"),a=null,o=null,s=("string"==typeof r&&(r=k(i,r))&&(s=r.start,r=r.end,a=i.slice(0,s),o=i.slice(r),i=i.slice(s,r)),w(i,"m=",t));if(null!==s){for(var u=C(i,s+1,-1,"m="),c=(null===u&&(u=i.length),new Set),l=new Set,d=new Set,f=[],p=[],h=s+1;h<u;){var b=i[h];if(""===b)break;if(-1<b.indexOf("a=ssrc:")){var m=function(e){return e.split(" ")[0].split(":")[1]}(i[h]);if(l.add(m),-1<b.indexOf("cname")||-1<b.indexOf("msid"))for(var v=1;v<n;v++){var g=parseInt(m)+v+"";f.push(b.replace(m,g))}else c.add(b)}if(-1<b.indexOf("a=ssrc-group:FID")){var y=b.split(" ");d.add(y[2]);for(var _=1;_<n;_++){var S=parseInt(y[1])+_+"",P=parseInt(y[2])+_+"";p.push(b.replace(y[1],S).replace(y[2],P))}}h++}r=h;l.forEach(function(e){if(!d.has(e)){for(var t=(t="a=ssrc-group:SIM")+" "+e,r=1;r<n;r++)t=t+" "+(parseInt(e)+r);p.push(t)}}),f.sort(),i.splice.apply(i,[r,0].concat(p)),i.splice.apply(i,[r,0].concat(f)),i=i.filter(function(e){return!c.has(e)}),a&&(i=a.concat(i).concat(o)),e=i.join("\r\n")}}return e},r.reorderCodecs=function(e,t,r,n){if(r&&0!==r.length){r="audio"===t?r.concat(S):r.concat(P);var i=e.split("\r\n"),a=null,o=null,s=("string"==typeof n&&(n=k(i,n))&&(s=n.start,n=n.end,a=i.slice(0,s),o=i.slice(n),i=i.slice(s,n)),w(i,"m=",t));if(null!==s){var u,n=i[s].split(" "),c=(n.splice(0,3),[]),l=g(r);try{for(l.s();!(u=l.n()).done;)for(var d=u.value,f=0;f<i.length;f++){var p,h=C(i,f,-1,"a=rtpmap",d);null!==h&&(p=_(i[h]))&&(c.push(p),f=h)}}catch(e){l.e(e)}finally{l.f()}c=function(e,t){var r,n=g(t);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,o=w(e,"a=fmtp","apt="+a);null!==o&&(i=y(e[o]),t.push(i.pt))}}catch(e){n.e(e)}finally{n.f()}return t}(i,c),i[s]=function(e,t){e=e.split(" ").slice(0,3);return(e=e.concat(t)).join(" ")}(i[s],c);var b,m=g(n);try{for(m.s();!(b=m.n()).done;){var v=b.value;-1===c.indexOf(v)&&(i=function(e,t){for(var r=new RegExp("a=(rtpmap|rtcp-fb|fmtp):"+t+"\\s"),n=e.length-1;0<n;n--)e[n].match(r)&&e.splice(n,1);return e}(i,v))}}catch(e){m.e(e)}finally{m.f()}a&&(i=a.concat(i).concat(o)),e=i.join("\r\n")}}return e},r.setMaxBitrate=function(e,t,r){var n,i=g(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.maxBitrate&&(e=u(e,a.codec.name,"x-google-max-bitrate",a.maxBitrate.toString(),r))}}catch(e){i.e(e)}finally{i.f()}return e},n(e("./logger.js")));function g(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?s(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t,r,n,i){var a=e.split("\r\n"),o=null,s=null,u=("string"==typeof i&&(i=k(a,i))&&(u=i.start,i=i.end,o=a.slice(0,u),s=a.slice(i),a=a.slice(u,i)),d(a=a.length<=1?e.split("\n"):a,t)),i={};if(null===u){t=w(a,"a=rtpmap",t);if(null===t)return e;var c=_(a[t]);i.pt=c.toString(),i.params={},i.params[r]=n,a.splice(t+1,0,l(i))}else(i=y(a[u])).params[r]=n,a[u]=l(i);return e=(a=o?o.concat(a).concat(s):a).join("\r\n")}function y(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split(";"),r=new RegExp("a=fmtp:(\\d+)"),e=e.match(r);if(!e||2!==e.length)return null;t.pt=e[1];for(var i={},a=0;a<n.length;++a){var o=n[a].split("=");2===o.length&&(i[o[0]]=o[1])}return t.params=i,t}function l(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t,r=e.pt,n=e.params,i=[],a=0;for(t in n)i[a]=t+"="+n[t],++a;return 0===a?null:"a=fmtp:"+r.toString()+" "+i.join(";")}function d(e,t){t=function(e,t){t=w(e,"a=rtpmap",t);return t?_(e[t]):null}(e,t);return t?w(e,"a=fmtp:"+t.toString()):null}function w(e,t,r){return C(e,0,-1,t,r)}function C(e,t,r,n,i){for(var a=-1!==r?r:e.length,o=t;o<a;++o)if(0===e[o].indexOf(n)&&(!i||-1!==e[o].toLowerCase().indexOf(i.toLowerCase())))return o;return null}function _(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),e=e.match(t);return e&&2===e.length?e[1]:null}var S=["CN","telephone-event"],P=["red","ulpfec","flexfec"];function k(e,t){var r="a=mid:"+t,n=w(e,r);if(null===n)o.default.debug("Specified MID is not found");else{for(;0<=n&&e[n]!==r;)n=C(e,n,-1,r);if(0<=n){for(var t=C(e,n,-1,"m=")||-1,i=-1,a=n;0<=a;a--)if(0<=e[a].indexOf("m=")){i=a;break}if(0<=i)return{start:i,end:t}}}return null}},{"./logger.js":29,"@babel/runtime/helpers/interopRequireDefault":10}],34:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),s=(Object.defineProperty(r,"__esModule",{value:!0}),r.StreamSourceInfo=r.StreamEvent=r.Stream=r.RemoteStream=r.LocalStream=void 0,n(e("@babel/runtime/helpers/typeof"))),u=n(e("@babel/runtime/helpers/assertThisInitialized")),c=n(e("@babel/runtime/helpers/inherits")),i=n(e("@babel/runtime/helpers/possibleConstructorReturn")),a=n(e("@babel/runtime/helpers/getPrototypeOf")),l=n(e("@babel/runtime/helpers/createClass")),d=n(e("@babel/runtime/helpers/classCallCheck")),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=p(t);if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var a;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("./utils.js")),n=e("./event.js");function p(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(p=function(e){return e?r:t})(e))}function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,a.default)(r);return e=n?(e=(0,a.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,i.default)(this,e)}}function b(t,e){return e.some(function(e){return e===t})}r.StreamSourceInfo=(0,l.default)(function e(t,r,n){if((0,d.default)(this,e),!b(t,[void 0,"mic","screen-cast","file","mixed"]))throw new TypeError("Incorrect value for audioSourceInfo");if(!b(r,[void 0,"camera","screen-cast","file","encoded-file","raw-file","mixed"]))throw new TypeError("Incorrect value for videoSourceInfo");this.audio=t,this.video=r,this.data=n});var m=function(e){(0,c.default)(a,e);var i=h(a);function a(e,t,r){var n;if((0,d.default)(this,a),n=i.call(this),e&&!(e instanceof MediaStream)&&!("function"==typeof WebTransportBidirectionalStream&&e instanceof WebTransportBidirectionalStream)||"object"!==(0,s.default)(t))throw new TypeError("Invalid stream or sourceInfo.");if(e&&e instanceof MediaStream&&(0<e.getAudioTracks().length&&!t.audio||0<e.getVideoTracks().length&&!t.video))throw new TypeError("Missing audio source info or video source info.");return e instanceof MediaStream&&Object.defineProperty((0,u.default)(n),"mediaStream",{configurable:!1,writable:!0,value:e}),Object.defineProperty((0,u.default)(n),"stream",{configurable:!1,writable:!0,value:e}),Object.defineProperty((0,u.default)(n),"source",{configurable:!1,writable:!1,value:t}),Object.defineProperty((0,u.default)(n),"attributes",{configurable:!0,writable:!1,value:r}),n}return(0,l.default)(a)}(n.EventDispatcher),e=(r.Stream=m,function(){(0,c.default)(i,m);var n=h(i);function i(e,t,r){if((0,d.default)(this,i),e)return e=n.call(this,e,t,r),Object.defineProperty((0,u.default)(e),"id",{configurable:!1,writable:!1,value:f.createUuid()}),e;throw new TypeError("Stream cannot be null.")}return(0,l.default)(i)}()),e=(r.LocalStream=e,function(){(0,c.default)(o,m);var a=h(o);function o(e,t,r,n,i){return(0,d.default)(this,o),r=a.call(this,r,n,i),Object.defineProperty((0,u.default)(r),"id",{configurable:!1,writable:!1,value:e||f.createUuid()}),Object.defineProperty((0,u.default)(r),"origin",{configurable:!1,writable:!1,value:t}),r.settings=void 0,r.extraCapabilities=void 0,r}return(0,l.default)(o)}()),e=(r.RemoteStream=e,function(e){(0,c.default)(n,e);var r=h(n);function n(e,t){return(0,d.default)(this,n),(e=r.call(this,e)).stream=t.stream,e}return(0,l.default)(n)}(n.OwtEvent));r.StreamEvent=e},{"./event.js":27,"./utils.js":36,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/typeof":21}],35:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.TransportType=r.TransportSettings=r.TransportConstraints=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),n=(r.TransportType={QUIC:"quic",WEBRTC:"webrtc"},(0,i.default)(function e(t,r){(0,a.default)(this,e),this.type=t,this.id=r})),e=(r.TransportConstraints=n,(0,i.default)(function e(t,r){(0,a.default)(this,e),this.type=t,this.id=r,this.rtpTransceivers=void 0}));r.TransportSettings=e},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createUuid=function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},r.isChrome=function(){return null!==window.navigator.userAgent.match("Chrome")},r.isEdge=function(){return null!==window.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)},r.isFirefox=function(){return null!==window.navigator.userAgent.match("Firefox")},r.isSafari=i,r.sysInfo=function(){var e=Object.create({}),t=(e.sdk={version:n,type:"JavaScript"},navigator.userAgent),r=/Chrome\/([0-9.]+)/.exec(t);r?e.runtime={name:"Chrome",version:r[1]}:(r=/Firefox\/([0-9.]+)/.exec(t))?e.runtime={name:"Firefox",version:r[1]}:(r=/Edge\/([0-9.]+)/.exec(t))?e.runtime={name:"Edge",version:r[1]}:i()?(r=/Version\/([0-9.]+) Safari/.exec(t),e.runtime={name:"Safari"},e.runtime.version=r?r[1]:"Unknown"):e.runtime={name:"Unknown",version:"Unknown"};(r=/Windows NT ([0-9.]+)/.exec(t))?e.os={name:"Windows NT",version:r[1]}:(r=/Intel Mac OS X ([0-9_.]+)/.exec(t))?e.os={name:"Mac OS X",version:r[1].replace(/_/g,".")}:(r=/iPhone OS ([0-9_.]+)/.exec(t))?e.os={name:"iPhone OS",version:r[1].replace(/_/g,".")}:(r=/X11; Linux/.exec(t))?e.os={name:"Linux",version:"Unknown"}:(r=/Android( ([0-9.]+))?/.exec(t))?e.os={name:"Android",version:r[1]||"Unknown"}:(r=/CrOS/.exec(t))?e.os={name:"Chrome OS",version:"Unknown"}:e.os={name:"Unknown",version:"Unknown"};return e.capabilities={continualIceGathering:!1,streamRemovable:"Firefox"!==e.runtime.name,ignoreDataChannelAcks:!0},e};var n="5.1";function i(){return/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent)}},{}],37:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),w=(Object.defineProperty(r,"__esModule",{value:!0}),r.ConferencePeerConnectionChannel=void 0,n(e("@babel/runtime/regenerator"))),s=n(e("@babel/runtime/helpers/slicedToArray")),C=n(e("@babel/runtime/helpers/typeof")),u=n(e("@babel/runtime/helpers/asyncToGenerator")),c=n(e("@babel/runtime/helpers/classCallCheck")),l=n(e("@babel/runtime/helpers/createClass")),d=n(e("@babel/runtime/helpers/inherits")),i=n(e("@babel/runtime/helpers/possibleConstructorReturn")),a=n(e("@babel/runtime/helpers/getPrototypeOf")),k=n(e("../base/logger.js")),E=e("../base/event.js"),f=e("../base/mediaformat.js"),p=e("../base/publication.js"),h=e("./subscription.js"),j=e("./error.js"),O=g(e("../base/utils.js")),b=g(e("../base/sdputils.js")),m=e("../base/transport.js");function v(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(v=function(e){return e?r:t})(e))}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=v(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function x(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?y(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,a.default)(r);return e=n?(e=(0,a.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,i.default)(this,e)}}n=function(e){(0,d.default)(o,e);var r,n,i,a=_(o);function o(e,t){var r;return(0,c.default)(this,o),(r=a.call(this)).pc=null,r._config=e,r._videoCodecs=void 0,r._options=null,r._videoCodecs=void 0,r._signaling=t,r._internalId=null,r._pendingCandidates=[],r._subscribePromises=new Map,r._publishPromises=new Map,r._publications=new Map,r._subscriptions=new Map,r._publishTransceivers=new Map,r._subscribeTransceivers=new Map,r._reverseIdMap=new Map,r._disconnectTimer=null,r._ended=!1,r._id=void 0,r._internalCount=0,r._sdpPromise=Promise.resolve(),r._sdpResolverMap=new Map,r._sdpResolvers=[],r._sdpResolveNum=0,r._remoteMediaStreams=new Map,r._createPeerConnection(),r}return(0,l.default)(o,[{key:"onMessage",value:function(e,t){switch(e){case"progress":"soac"===t.status?this._sdpHandler(t.data):"ready"===t.status?this._readyHandler(t.sessionId):"error"===t.status&&this._errorHandler(t.sessionId,t.data);break;case"stream":this._onStreamEvent(t);break;default:k.default.warning("Unknown notification from MCU.")}}},{key:"publishWithTransceivers",value:(i=(0,u.default)(w.default.mark(function e(u,c){var t,l,r,n,d=this;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=x(c),e.prev=1,r=w.default.mark(function e(){var t,r,n,i,a,o,s;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("sendonly"!==(t=l.value).direction)return e.abrupt("return",{v:Promise.reject("RTCRtpTransceiver's direction must be sendonly.")});e.next=3;break;case 3:if(u.stream.getTracks().includes(t.sender.track)){e.next=5;break}return e.abrupt("return",{v:Promise.reject("The track associated with RTCRtpSender is not included in stream.")});case 5:if(2<c.length)return e.abrupt("return",{v:Promise.reject("At most one transceiver for audio and one transceiver for video are accepted.")});e.next=7;break;case 7:return r=c.map(function(e){var t=e.sender.track.kind;return{type:t,transceiver:e,source:u.source[t],option:{}}}),n=d._createInternalId(),e.next=11,d._chainSdpPromise(n);case 11:return d._publishTransceivers.set(n,r),e.next=14,d.pc.createOffer();case 14:return i=e.sent,e.next=17,d.pc.setLocalDescription(i);case 17:return s=c.map(function(e){var t=e.sender.track.kind;return{type:t,source:u.source[t],mid:e.mid}}),e.next=20,d._signaling.sendSignalingMessage("publish",{media:{tracks:s},attributes:u.attributes,transport:{id:d._id,type:"webrtc"}});case 20:if(a=e.sent,o=a.id,d._publishTransceivers.get(n).id=o,d._reverseIdMap.set(o,n),d._id&&d._id!==a.transportId)return k.default.warning("Server returns conflict ID: "+a.transportId),e.abrupt("return",{v:void 0});e.next=27;break;case 27:return d._id=a.transportId,s=new E.MessageEvent("id",{message:o,origin:d._remoteId}),d.dispatchEvent(s),e.next=32,d._signaling.sendSignalingMessage("soac",{id:d._id,signaling:i});case 32:return e.abrupt("return",{v:new Promise(function(e,t){d._publishPromises.set(n,{resolve:e,reject:t})})});case 33:case"end":return e.stop()}},e)}),t.s();case 4:if((l=t.n()).done){e.next=11;break}return e.delegateYield(r(),"t0",6);case 6:if(n=e.t0,"object"===(0,C.default)(n))return e.abrupt("return",n.v);e.next=9;break;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(1),t.e(e.t1);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}},e,null,[[1,13,16,19]])})),function(e,t){return i.apply(this,arguments)})},{key:"publish",value:(n=(0,u.default)(w.default.mark(function e(t,r,n){var i,a,o,s,u,c,l,d,f,p,h,b,m,v,g,y,_,S,P=this;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ended)return e.abrupt("return",Promise.reject("Connection closed"));e.next=2;break;case 2:if(Array.isArray(r))return e.abrupt("return",this.publishWithTransceivers(t,r));e.next=4;break;case 4:if(void 0===r&&(r={audio:!!t.mediaStream.getAudioTracks().length,video:!!t.mediaStream.getVideoTracks().length}),"object"!==(0,C.default)(r))return e.abrupt("return",Promise.reject(new TypeError("Options should be an object.")));e.next=7;break;case 7:if(this._isRtpEncodingParameters(r.audio)&&this._isOwtEncodingParameters(r.video)||this._isOwtEncodingParameters(r.audio)&&this._isRtpEncodingParameters(r.video))return e.abrupt("return",Promise.reject(new j.ConferenceError("Mixing RTCRtpEncodingParameters and AudioEncodingParameters/VideoEncodingParameters is not allowed.")));e.next=9;break;case 9:if(void 0===r.audio&&(r.audio=!!t.mediaStream.getAudioTracks().length),void 0===r.video&&(r.video=!!t.mediaStream.getVideoTracks().length),r.audio&&!t.mediaStream.getAudioTracks().length||r.video&&!t.mediaStream.getVideoTracks().length)return e.abrupt("return",Promise.reject(new j.ConferenceError("options.audio/video is inconsistent with tracks presented in the MediaStream.")));e.next=13;break;case 13:if(!1!==r.audio&&null!==r.audio||!1!==r.video&&null!==r.video){e.next=15;break}return e.abrupt("return",Promise.reject(new j.ConferenceError("Cannot publish a stream without audio and video.")));case 15:if("object"!==(0,C.default)(r.audio)){e.next=35;break}if(Array.isArray(r.audio)){e.next=18;break}return e.abrupt("return",Promise.reject(new TypeError("options.audio should be a boolean or an array.")));case 18:i=x(r.audio),e.prev=19,i.s();case 21:if((o=i.n()).done)e.next=27;else{if(!(o=o.value).codec||"string"!=typeof o.codec.name||void 0!==o.maxBitrate&&"number"!=typeof o.maxBitrate)return e.abrupt("return",Promise.reject(new TypeError("options.audio has incorrect parameters.")));e.next=25}break;case 25:e.next=21;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(19),i.e(e.t0);case 32:return e.prev=32,i.f(),e.finish(32);case 35:if("object"!==(0,C.default)(r.video)||Array.isArray(r.video)){e.next=37;break}return e.abrupt("return",Promise.reject(new TypeError("options.video should be a boolean or an array.")));case 37:if(!this._isOwtEncodingParameters(r.video)){e.next=55;break}a=x(r.video),e.prev=39,a.s();case 41:if((o=a.n()).done)e.next=47;else{if(!(u=o.value).codec||"string"!=typeof u.codec.name||void 0!==u.maxBitrate&&"number"!=typeof u.maxBitrate||void 0!==u.codec.profile&&"string"!=typeof u.codec.profile)return e.abrupt("return",Promise.reject(new TypeError("options.video has incorrect parameters.")));e.next=45}break;case 45:e.next=41;break;case 47:e.next=52;break;case 49:e.prev=49,e.t1=e.catch(39),a.e(e.t1);case 52:return e.prev=52,a.f(),e.finish(52);case 55:if(s={},0<t.mediaStream.getAudioTracks().length&&!1!==r.audio&&null!==r.audio){if(1<t.mediaStream.getAudioTracks().length&&k.default.warning("Publishing a stream with multiple audio tracks is not fully supported."),"boolean"!=typeof r.audio&&"object"!==(0,C.default)(r.audio))return e.abrupt("return",Promise.reject(new j.ConferenceError("Type of audio options should be boolean or an object.")));e.next=60}else e.next=64;break;case 60:s.audio={},s.audio.source=t.source.audio,e.next=65;break;case 64:s.audio=!1;case 65:return 0<t.mediaStream.getVideoTracks().length&&!1!==r.video&&null!==r.video?(1<t.mediaStream.getVideoTracks().length&&k.default.warning("Publishing a stream with multiple video tracks is not fully supported."),s.video={},s.video.source=t.source.video,u=t.mediaStream.getVideoTracks()[0].getSettings(),s.video.parameters={resolution:{width:u.width,height:u.height},framerate:u.frameRate}):s.video=!1,c=this._createInternalId(),e.next=69,this._chainSdpPromise(c);case 69:if(l={},d=[],"function"!=typeof this.pc.addTransceiver)e.next=94;else{if(s.audio&&0<t.mediaStream.getAudioTracks().length&&(f={direction:"sendonly",streams:[t.mediaStream]},this._isRtpEncodingParameters(r.audio)&&(f.sendEncodings=r.audio),p=this.pc.addTransceiver(t.mediaStream.getAudioTracks()[0],f),d.push({type:"audio",transceiver:p,source:s.audio.source,option:{audio:r.audio}}),O.isFirefox())&&O.sysInfo().runtime.version.split(".")[0]<110)return(h=p.sender.getParameters()).encodings=f.sendEncodings,e.next=82,p.sender.setParameters(h);e.next=82}break;case 82:if(s.video&&0<t.mediaStream.getVideoTracks().length)if(f={direction:"sendonly",streams:[t.mediaStream]},this._isRtpEncodingParameters(r.video)&&(f.sendEncodings=r.video,this._videoCodecs=n),p=this.pc.addTransceiver(t.mediaStream.getVideoTracks()[0],f),d.push({type:"video",transceiver:p,source:s.video.source,option:{video:r.video}}),O.isFirefox()&&O.sysInfo().runtime.version.split(".")[0]<110)return(h=p.sender.getParameters()).encodings=f.sendEncodings,e.next=92,p.sender.setParameters(h);e.next=92;break;case 92:e.next=98;break;case 94:if(s.audio&&0<t.mediaStream.getAudioTracks().length){b=x(t.mediaStream.getAudioTracks());try{for(b.s();!(m=b.n()).done;)v=m.value,this.pc.addTrack(v,t.mediaStream)}catch(e){b.e(e)}finally{b.f()}}if(s.video&&0<t.mediaStream.getVideoTracks().length){g=x(t.mediaStream.getVideoTracks());try{for(g.s();!(y=g.n()).done;)_=y.value,this.pc.addTrack(_,t.mediaStream)}catch(e){g.e(e)}finally{g.f()}}l.offerToReceiveAudio=!1,l.offerToReceiveVideo=!1;case 98:return this._publishTransceivers.set(c,{transceivers:d}),this.pc.createOffer(l).then(function(e){return S=e,P.pc.setLocalDescription(e)}).then(function(){var n=[];return d.forEach(function(e){var t=e.type,r=e.transceiver,e=e.source;n.push({type:t,mid:r.mid,source:e})}),P._signaling.sendSignalingMessage("publish",{media:{tracks:n},attributes:t.attributes,transport:{id:P._id,type:"webrtc"}}).catch(function(e){throw P._signaling.sendSignalingMessage("soac",{id:P._id,signaling:S}),e})}).then(function(e){var t=e.id;P._publishTransceivers.get(c).id=t,P._reverseIdMap.set(t,c),P._id&&P._id!==e.transportId?k.default.warning("Server returns conflict ID: "+e.transportId):(P._id=e.transportId,e=new E.MessageEvent("id",{message:t,origin:P._remoteId}),P.dispatchEvent(e),r&&d.forEach(function(e){e.type;var t=e.transceiver,e=e.option;S.sdp=P._setRtpReceiverOptions(S.sdp,e,t.mid),S.sdp=P._setRtpSenderOptions(S.sdp,e,t.mid)}),P._signaling.sendSignalingMessage("soac",{id:P._id,signaling:S}))}).catch(function(e){k.default.error("Failed to create offer or set SDP. Message: "+e.message),P._publishTransceivers.get(c).id?(P._unpublish(c),P._rejectPromise(e),P._fireEndedEventOnPublicationOrSubscription()):P._unpublish(c)}),e.abrupt("return",new Promise(function(e,t){P._publishPromises.set(c,{resolve:e,reject:t})}));case 101:case"end":return e.stop()}},e,this,[[19,29,32,35],[39,49,52,55]])})),function(e,t,r){return n.apply(this,arguments)})},{key:"subscribe",value:(r=(0,u.default)(w.default.mark(function e(t,r){var n,i,a,o,s,u,c=this;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ended)return e.abrupt("return",Promise.reject("Connection closed"));e.next=2;break;case 2:if(void 0===r&&(r={audio:!!t.settings.audio,video:!!t.settings.video}),"object"!==(0,C.default)(r))return e.abrupt("return",Promise.reject(new TypeError("Options should be an object.")));e.next=5;break;case 5:if(void 0===r.audio&&(r.audio=!!t.settings.audio),void 0===r.video&&(r.video=!!t.settings.video),void 0!==r.audio&&"object"!==(0,C.default)(r.audio)&&"boolean"!=typeof r.audio&&null!==r.audio||void 0!==r.video&&"object"!==(0,C.default)(r.video)&&"boolean"!=typeof r.video&&null!==r.video)return e.abrupt("return",Promise.reject(new TypeError("Invalid options type.")));e.next=9;break;case 9:if(r.audio&&!t.settings.audio||r.video&&!t.settings.video)return e.abrupt("return",Promise.reject(new j.ConferenceError("options.audio/video cannot be true or an object if there is no audio/video track in remote stream.")));e.next=11;break;case 11:if(!1===r.audio&&!1===r.video)return e.abrupt("return",Promise.reject(new j.ConferenceError("Cannot subscribe a stream without audio and video.")));e.next=13;break;case 13:if(n={},r.audio){if("object"===(0,C.default)(r.audio)&&Array.isArray(r.audio.codecs)&&0===r.audio.codecs.length)return e.abrupt("return",Promise.reject(new TypeError("Audio codec cannot be an empty array.")));e.next=18}else e.next=22;break;case 18:n.audio={},n.audio.from=t.id,e.next=23;break;case 22:n.audio=!1;case 23:if(r.video){if("object"===(0,C.default)(r.video)&&Array.isArray(r.video.codecs)&&0===r.video.codecs.length)return e.abrupt("return",Promise.reject(new TypeError("Video codec cannot be an empty array.")));e.next=27}else e.next=33;break;case 27:n.video={},n.video.from=t.id,(r.video.resolution||r.video.frameRate||r.video.bitrateMultiplier&&1!==r.video.bitrateMultiplier||r.video.keyFrameInterval)&&(n.video.parameters={resolution:r.video.resolution,framerate:r.video.frameRate,bitrate:r.video.bitrateMultiplier?"x"+r.video.bitrateMultiplier.toString():void 0,keyFrameInterval:r.video.keyFrameInterval}),r.video.rid&&((a=t.settings.video.find(function(e){return e.rid===r.video.rid}))&&a._trackId&&(n.video.from=a._trackId,delete n.video.parameters),r.video=!0),e.next=34;break;case 33:n.video=!1;case 34:return i=this._createInternalId(),e.next=37,this._chainSdpPromise(i);case 37:return a={},o=[],"function"==typeof this.pc.addTransceiver?(n.audio&&(s=this.pc.addTransceiver("audio",{direction:"recvonly"}),o.push({type:"audio",transceiver:s,from:n.audio.from,option:{audio:r.audio}})),n.video&&(s=this.pc.addTransceiver("video",{direction:"recvonly"}),o.push({type:"video",transceiver:s,from:n.video.from,parameters:n.video.parameters,option:{video:r.video}}))):(a.offerToReceiveAudio=!!r.audio,a.offerToReceiveVideo=!!r.video),this._subscribeTransceivers.set(i,{transceivers:o}),this.pc.createOffer(a).then(function(e){return u=e,c.pc.setLocalDescription(e).catch(function(e){throw k.default.error("Set local description failed. Message: "+JSON.stringify(e)),e})},function(e){throw k.default.error("Create offer failed. Error info: "+JSON.stringify(e)),e}).then(function(){var a=[];return o.forEach(function(e){var t=e.type,r=e.transceiver,n=e.from,i=e.parameters;e.option;a.push({type:t,mid:r.mid,from:n,parameters:i})}),c._signaling.sendSignalingMessage("subscribe",{media:{tracks:a},transport:{id:c._id,type:"webrtc"}}).catch(function(e){throw c._signaling.sendSignalingMessage("soac",{id:c._id,signaling:u}),e})}).then(function(e){var t=e.id;c._subscribeTransceivers.get(i).id=t,c._reverseIdMap.set(t,i),c._id&&c._id!==e.transportId?k.default.warning("Server returns conflict ID: "+e.transportId):(c._id=e.transportId,e=new E.MessageEvent("id",{message:t,origin:c._remoteId}),c.dispatchEvent(e),r&&o.forEach(function(e){e.type;var t=e.transceiver,e=e.option;u.sdp=c._setRtpReceiverOptions(u.sdp,e,t.mid)}),c._signaling.sendSignalingMessage("soac",{id:c._id,signaling:u}))}).catch(function(e){k.default.error("Failed to create offer or set SDP. Message: "+e.message),c._subscribeTransceivers.get(i).id?(c._unsubscribe(i),c._rejectPromise(e),c._fireEndedEventOnPublicationOrSubscription()):c._unsubscribe(i)}),e.abrupt("return",new Promise(function(e,t){c._subscribePromises.set(i,{resolve:e,reject:t})}));case 43:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"close",value:function(){this.pc&&"closed"!==this.pc.signalingState&&this.pc.close()}},{key:"_chainSdpPromise",value:function(r){var n=this,e=this._sdpPromise;return this._sdpPromise=e.then(function(){return new Promise(function(e,t){e={finish:!1,resolve:e,reject:t};n._sdpResolvers.push(e),n._sdpResolverMap.set(r,e),setTimeout(function(){return t("Timeout to get SDP answer")},1e4)})}),e.catch(function(e){})}},{key:"_nextSdpPromise",value:function(){for(var e=!1;this._sdpResolveNum<this._sdpResolvers.length;){var t=this._sdpResolvers[this._sdpResolveNum];this._sdpResolveNum++,t.finish||(t.resolve(),e=t.finish=!0)}return e}},{key:"_createInternalId",value:function(){return this._internalCount++}},{key:"_unpublish",value:function(e){var t,r,n=this;this._publishTransceivers.has(e)&&(t=(r=this._publishTransceivers.get(e)).id,r=r.transceivers,t&&(this._signaling.sendSignalingMessage("unpublish",{id:t}).catch(function(e){k.default.warning("MCU returns negative ack for unpublishing, "+e)}),this._reverseIdMap.delete(t)),r.forEach(function(e){e=e.transceiver;"stable"===n.pc.signalingState&&(e.sender.replaceTrack(null),n.pc.removeTrack(e.sender))}),this._publishTransceivers.delete(e),this._publications.has(t)?(r=new E.OwtEvent("ended"),this._publications.get(t).dispatchEvent(r),this._publications.delete(t)):(k.default.warning("Invalid publication to unpublish: "+t),this._publishPromises.has(e)&&this._publishPromises.get(e).reject(new j.ConferenceError("Failed to publish"))),this._sdpResolverMap.has(e))&&((r=this._sdpResolverMap.get(e)).finish||(r.resolve(),r.finish=!0),this._sdpResolverMap.delete(e))}},{key:"_unsubscribe",value:function(e){var t,r;this._subscribeTransceivers.has(e)&&(t=(r=this._subscribeTransceivers.get(e)).id,r=r.transceivers,t&&this._signaling.sendSignalingMessage("unsubscribe",{id:t}).catch(function(e){k.default.warning("MCU returns negative ack for unsubscribing, "+e)}),r.forEach(function(e){e.transceiver.receiver.track.stop()}),this._subscribeTransceivers.delete(e),this._subscriptions.has(t)?(r=new E.OwtEvent("ended"),this._subscriptions.get(t).dispatchEvent(r),this._subscriptions.delete(t)):(k.default.warning("Invalid subscription to unsubscribe: "+t),this._subscribePromises.has(e)&&this._subscribePromises.get(e).reject(new j.ConferenceError("Failed to subscribe"))),this._sdpResolverMap.has(e))&&((r=this._sdpResolverMap.get(e)).finish||(r.resolve(),r.finish=!0),this._sdpResolverMap.delete(e))}},{key:"_muteOrUnmute",value:function(t,r,n,i){var a=this;return this._signaling.sendSignalingMessage(n?"stream-control":"subscription-control",{id:t,operation:r?"pause":"play",data:i}).then(function(){var e;n||(e=r?"mute":"unmute",a._subscriptions.get(t).dispatchEvent(new E.MuteEvent(e,{kind:i})))})}},{key:"_applyOptions",value:function(e,t){var r;return"object"!==(0,C.default)(t)||"object"!==(0,C.default)(t.video)?Promise.reject(new j.ConferenceError("Options should be an object.")):((r={}).resolution=t.video.resolution,r.framerate=t.video.frameRate,r.bitrate=t.video.bitrateMultiplier?"x"+t.video.bitrateMultiplier.toString():void 0,r.keyFrameInterval=t.video.keyFrameInterval,this._signaling.sendSignalingMessage("subscription-control",{id:e,operation:"update",data:{video:{parameters:r}}}).then())}},{key:"_onRemoteStreamAdded",value:function(t){k.default.debug("Remote stream added.");var e,r=x(this._subscribeTransceivers);try{for(r.s();!(e=r.n()).done;){var n,i=(0,s.default)(e.value,2),a=i[0],o=i[1];if(o.transceivers.find(function(e){return e.transceiver===t.transceiver}))return void(this._subscriptions.has(o.id)?((n=this._subscriptions.get(o.id)).stream=t.streams[0],this._subscribePromises.has(a)&&(this._subscribePromises.get(a).resolve(n),this._subscribePromises.delete(a))):this._remoteMediaStreams.set(o.id,t.streams[0]))}}catch(e){r.e(e)}finally{r.f()}k.default.warning("Received remote stream without subscription.")}},{key:"_onLocalIceCandidate",value:function(e){e.candidate?"stable"!==this.pc.signalingState?this._pendingCandidates.push(e.candidate):this._sendCandidate(e.candidate):k.default.debug("Empty candidate.")}},{key:"_fireEndedEventOnPublicationOrSubscription",value:function(){if(!this._ended){this._ended=!0;var e,t=new E.OwtEvent("ended"),r=x(this._publications);try{for(r.s();!(e=r.n()).done;){var n=(0,s.default)(e.value,2)[1];n.dispatchEvent(t),n.stop()}}catch(e){r.e(e)}finally{r.f()}var i,a=x(this._subscriptions);try{for(a.s();!(i=a.n()).done;){var o=(0,s.default)(i.value,2)[1];o.dispatchEvent(t),o.stop()}}catch(e){a.e(e)}finally{a.f()}this.dispatchEvent(t),this.close()}}},{key:"_rejectPromise",value:function(e){e=e||new j.ConferenceError("Connection failed or closed."),this.pc&&"closed"!==this.pc.iceConnectionState&&this.pc.close();var t,r=x(this._publishPromises);try{for(r.s();!(t=r.n()).done;)(0,s.default)(t.value,2)[1].reject(e)}catch(e){r.e(e)}finally{r.f()}this._publishPromises.clear();var n,i=x(this._subscribePromises);try{for(i.s();!(n=i.n()).done;)(0,s.default)(n.value,2)[1].reject(e)}catch(e){i.e(e)}finally{i.f()}this._subscribePromises.clear()}},{key:"_onIceConnectionStateChange",value:function(e){e&&e.currentTarget&&(k.default.debug("ICE connection state changed to "+e.currentTarget.iceConnectionState),"closed"!==e.currentTarget.iceConnectionState&&"failed"!==e.currentTarget.iceConnectionState||("failed"===e.currentTarget.iceConnectionState?this._handleError("connection failed."):this._fireEndedEventOnPublicationOrSubscription()))}},{key:"_onConnectionStateChange",value:function(e){"closed"!==this.pc.connectionState&&"failed"!==this.pc.connectionState||("failed"===this.pc.connectionState?this._handleError("connection failed."):this._fireEndedEventOnPublicationOrSubscription())}},{key:"_sendCandidate",value:function(e){this._signaling.sendSignalingMessage("soac",{id:this._id,signaling:{type:"candidate",candidate:{candidate:"a="+e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex}}})}},{key:"_createPeerConnection",value:function(){var e,t=this;this.pc?k.default.warning("A PeerConnection was created. Cannot create again for the same PeerConnectionChannel."):(e=this._config.rtcConfiguration||{},O.isChrome()&&(e.bundlePolicy="max-bundle"),this.pc=new RTCPeerConnection(e),this.pc.onicecandidate=function(e){t._onLocalIceCandidate.apply(t,[e])},this.pc.ontrack=function(e){t._onRemoteStreamAdded.apply(t,[e])},this.pc.oniceconnectionstatechange=function(e){t._onIceConnectionStateChange.apply(t,[e])},this.pc.onconnectionstatechange=function(e){t._onConnectionStateChange.apply(t,[e])})}},{key:"_getStats",value:function(){return this.pc?this.pc.getStats():Promise.reject(new j.ConferenceError("PeerConnection is not available."))}},{key:"_readyHandler",value:function(t){var e,r,n=this,i=this._reverseIdMap.get(t);this._subscribePromises.has(i)?(r=this._remoteMediaStreams.get(t),(e=new m.TransportSettings(m.TransportType.WEBRTC,this._id)).rtpTransceivers=this._subscribeTransceivers.get(i).transceivers,r=new h.Subscription(t,r,e,function(){n._unsubscribe(i)},function(){return n._getStats()},function(e){return n._muteOrUnmute(t,!0,!1,e)},function(e){return n._muteOrUnmute(t,!1,!1,e)},function(e){return n._applyOptions(t,e)}),this._subscriptions.set(t,r),this._subscriptions.get(t).stream&&(this._subscribePromises.get(i).resolve(r),this._subscribePromises.delete(i))):this._publishPromises.has(i)&&((e=new m.TransportSettings(m.TransportType.WEBRTC,this._id)).transceivers=this._publishTransceivers.get(i).transceivers,r=new p.Publication(t,e,function(){return n._unpublish(i),Promise.resolve()},function(){return n._getStats()},function(e){return n._muteOrUnmute(t,!0,!0,e)},function(e){return n._muteOrUnmute(t,!1,!0,e)}),this._publications.set(t,r),this._publishPromises.get(i).resolve(r))}},{key:"_sdpHandler",value:function(e){var n=this;"answer"===e.type&&this.pc.setRemoteDescription(e).then(function(){if(0<n._pendingCandidates.length){var e,t=x(n._pendingCandidates);try{for(t.s();!(e=t.n()).done;){var r=e.value;n._sendCandidate(r)}}catch(e){t.e(e)}finally{t.f()}}},function(e){k.default.error("Set remote description failed: "+e),n._rejectPromise(e),n._fireEndedEventOnPublicationOrSubscription()}).then(function(){n._nextSdpPromise()||k.default.warning("Unexpected SDP promise state")})}},{key:"_errorHandler",value:function(e,t){if(!e)return this._handleError(t);t=new E.ErrorEvent("error",{error:new j.ConferenceError(t)}),this._publications.has(e)&&this._publications.get(e).dispatchEvent(t),this._subscriptions.has(e)&&this._subscriptions.get(e).dispatchEvent(t),t=this._reverseIdMap.get(e);this._publishTransceivers.has(t)&&this._unpublish(t),this._subscribeTransceivers.has(t)&&this._unsubscribe(t)}},{key:"_handleError",value:function(e){e=new j.ConferenceError(e);if(!this._ended){var t,r=new E.ErrorEvent("error",{error:e}),n=x(this._publications);try{for(n.s();!(t=n.n()).done;)(0,s.default)(t.value,2)[1].dispatchEvent(r)}catch(e){n.e(e)}finally{n.f()}var i,a=x(this._subscriptions);try{for(a.s();!(i=a.n()).done;)(0,s.default)(i.value,2)[1].dispatchEvent(r)}catch(e){a.e(e)}finally{a.f()}this._fireEndedEventOnPublicationOrSubscription()}}},{key:"_setCodecOrder",value:function(e,t,r){var n;return t.audio&&(e=t.audio.codecs?(n=Array.from(t.audio.codecs,function(e){return e.name}),b.reorderCodecs(e,"audio",n,r)):(n=Array.from(t.audio,function(e){return e.codec.name}),b.reorderCodecs(e,"audio",n,r))),e=t.video?t.video.codecs?(n=Array.from(t.video.codecs,function(e){return e.name}),b.reorderCodecs(e,"video",n,r)):(n=Array.from(t.video,function(e){return e.codec.name}),b.reorderCodecs(e,"video",n,r)):e}},{key:"_setMaxBitrate",value:function(e,t,r){return"object"===(0,C.default)(t.audio)&&(e=b.setMaxBitrate(e,t.audio,r)),e="object"===(0,C.default)(t.video)?b.setMaxBitrate(e,t.video,r):e}},{key:"_setRtpSenderOptions",value:function(e,t,r){return e=this._isRtpEncodingParameters(t.audio)||this._isRtpEncodingParameters(t.video)?e:this._setMaxBitrate(e,t,r)}},{key:"_setRtpReceiverOptions",value:function(e,t,r){return this._isRtpEncodingParameters(t.video)&&O.isSafari()&&1<t.video.length&&(e=b.addLegacySimulcast(e,"video",t.video.length,r)),this._isRtpEncodingParameters(t.video)&&this._videoCodecs?b.reorderCodecs(e,"video",this._videoCodecs,r):this._isRtpEncodingParameters(t.audio)||this._isRtpEncodingParameters(t.video)?e:this._setCodecOrder(e,t,r)}},{key:"_onStreamEvent",value:function(e){var t,r,n=[],i=(this._publications.has(e.id)&&n.push(this._publications.get(e.id)),x(this._subscriptions));try{for(i.s();!(t=i.n()).done;){var a=t.value;e.id!==a._audioTrackId&&e.id!==a._videoTrackId||n.push(a)}}catch(e){i.e(e)}finally{i.f()}n.length&&("audio.status"===e.data.field?r=f.TrackKind.AUDIO:"video.status"===e.data.field?r=f.TrackKind.VIDEO:k.default.warning("Invalid data field for stream update info."),"active"===e.data.value?n.forEach(function(e){return e.dispatchEvent(new E.MuteEvent("unmute",{kind:r}))}):"inactive"===e.data.value?n.forEach(function(e){return e.dispatchEvent(new E.MuteEvent("mute",{kind:r}))}):k.default.warning("Invalid data value for stream update info."))}},{key:"_isRtpEncodingParameters",value:function(e){return!!Array.isArray(e)&&!!((e=e[0]).codecPayloadType||e.dtx||e.active||e.ptime||e.maxFramerate||e.scaleResolutionDownBy||e.rid||e.scalabilityMode)}},{key:"_isOwtEncodingParameters",value:function(e){return!!Array.isArray(e)&&!!e[0].codec}}]),o}(E.EventDispatcher);r.ConferencePeerConnectionChannel=n},{"../base/event.js":27,"../base/logger.js":29,"../base/mediaformat.js":30,"../base/publication.js":32,"../base/sdputils.js":33,"../base/transport.js":35,"../base/utils.js":36,"./error.js":39,"./subscription.js":47,"@babel/runtime/helpers/asyncToGenerator":4,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/slicedToArray":18,"@babel/runtime/helpers/typeof":21,"@babel/runtime/regenerator":24}],38:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),s=(Object.defineProperty(r,"__esModule",{value:!0}),r.ConferenceClient=void 0,n(e("@babel/runtime/regenerator"))),u=n(e("@babel/runtime/helpers/asyncToGenerator")),l=(n(e("@babel/runtime/helpers/createClass")),n(e("@babel/runtime/helpers/classCallCheck")),i(e("../base/event.js"))),d=e("./signaling.js"),w=n(e("../base/logger.js")),C=e("../base/base64.js"),k=e("./error.js"),E=i(e("../base/utils.js")),j=i(e("../base/stream.js")),O=e("./participant.js"),x=e("./info.js"),T=e("./channel.js"),I=e("./quicconnection.js"),R=e("./mixedstream.js"),M=i(e("./streamutils.js"));function c(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(c=function(e){return e?r:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=c(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function A(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?f(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){return(e=new l.OwtEvent(e,t)).participant=t.participant,e}var D=1,L=2,U=3;r.ConferenceClient=function(f,e){Object.setPrototypeOf(this,new l.EventDispatcher),f=f||{};var p,h,c=this,b=D,a=e||new d.SioSignaling,m=new Map,v=new Map,n=new Map,g=new Map,y=null,_=null;function t(t,r){var e,n,i,a,o,s,u;"soac"===t||"progress"===t?g.has(r.id)?g.get(r.id).onMessage(t,r):_&&_.hasContentSessionId(r.id)?_.onMessage(t,r):w.default.warning("Cannot find a channel for incoming data."):"stream"===t?"add"===r.status?(s=S(s=r.data),m.set(s.id,s),s=new j.StreamEvent("streamadded",{stream:s}),c.dispatchEvent(s)):"remove"===r.status?(s=r,m.has(s.id)?(s=m.get(s.id),u=new l.OwtEvent("ended"),m.delete(s.id),s.dispatchEvent(u)):w.default.warning("Cannot find specific remote stream.")):"update"===r.status&&("audio.status"===r.data.field||"video.status"===r.data.field?g.forEach(function(e){e.onMessage(t,r)}):"activeInput"===r.data.field?(u=r,m.has(u.id)?(o=m.get(u.id),u=new R.ActiveAudioInputChangeEvent("activeaudioinputchange",{activeAudioInputStreamId:u.data.value}),o.dispatchEvent(u)):w.default.warning("Cannot find specific remote stream.")):"video.layout"===r.data.field?(o=r,m.has(o.id)?(a=m.get(o.id),o=new R.LayoutChangeEvent("layoutchange",{layout:o.data.value}),a.dispatchEvent(o)):w.default.warning("Cannot find specific remote stream.")):"."===r.data.field?(a=r.data.value,m.has(a.id)?((i=m.get(a.id)).settings=M.convertToPublicationSettings(a.media),i.extraCapabilities=M.convertToSubscriptionCapabilities(a.media),a=new l.OwtEvent("updated"),i.dispatchEvent(a)):w.default.warning("Cannot find specific remote stream.")):w.default.warning("Unknown stream event from MCU.")):"text"===t?(i=r,i=new l.MessageEvent("messagereceived",{message:r.message,origin:r.from,to:r.to}),c.dispatchEvent(i)):"participant"===t&&("join"===(e=r).action?(e=e.data,n=new O.Participant(e.id,e.role,e.user),v.set(e.id,n),n=new N("participantjoined",{participant:n}),c.dispatchEvent(n)):"leave"===e.action&&(n=e.data,v.has(n)?(e=v.get(n),v.delete(n),e.dispatchEvent(new l.OwtEvent("left"))):w.default.warning("Received leave message from MCU for an unknown participant.")))}function S(e){var t,r,n,i;return"mixed"===e.type?new R.RemoteMixedStream(e):(n=e.media.tracks.find(function(e){return"audio"===e.type}),i=e.media.tracks.find(function(e){return"video"===e.type}),n&&(t=n.source),i&&(r=i.source),n=e.data,(i=new j.RemoteStream(e.id,e.info.owner,void 0,new j.StreamSourceInfo(t,r,n),e.info.attributes)).settings=M.convertToPublicationSettings(e.media),i.extraCapabilities=M.convertToSubscriptionCapabilities(e.media),i)}function r(e,t){return i.apply(this,arguments)}function i(){return(i=(0,u.default)(s.default.mark(function e(t,r){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.send(t,r));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function P(){var e=Object.create(l.EventDispatcher);return e.sendSignalingMessage=r,e}function o(){v.clear(),m.clear()}Object.defineProperty(this,"peerConnection",{configurable:!1,get:function(){var e;return null==(e=y)?void 0:e.pc}}),a.addEventListener("data",function(e){t(e.message.notification,e.message.data)}),a.addEventListener("disconnect",function(){o(),b=D,c.dispatchEvent(new l.OwtEvent("serverdisconnected"))}),Object.defineProperty(this,"info",{configurable:!1,get:function(){return h?new x.ConferenceInfo(h.id,Array.from(v,function(e){return e[1]}),Array.from(m,function(e){return e[1]}),p):null}}),this.join=function(i){return new Promise(function(l,t){var e,d=JSON.parse(C.Base64.decodeBase64(i)),r=!0===d.secure,n=d.host;"string"!=typeof n?t(new k.ConferenceError("Invalid host.")):(-1===n.indexOf("http")&&(n=r?"https://"+n:"http://"+n),b!==D?t(new k.ConferenceError("connection state invalid")):(b=L,e=E.sysInfo(),e={token:i,userAgent:{sdk:e.sdk},protocol:"1.2"},a.connect(n,r,e).then(function(e){if(b=U,void 0!==(h=e.room).streams){var t,r=A(h.streams);try{for(r.s();!(t=r.n()).done;){var n=t.value;"mixed"===n.type&&(n.viewport=n.info.label),m.set(n.id,S(n))}}catch(e){r.e(e)}finally{r.f()}}if(e.room&&void 0!==e.room.participants){var i,a=A(e.room.participants);try{for(a.s();!(i=a.n()).done;){var o=i.value;v.set(o.id,new O.Participant(o.id,o.role,o.user)),o.id===e.id&&(p=v.get(o.id))}}catch(e){a.e(e)}finally{a.f()}}s=P(),(u=new T.ConferencePeerConnectionChannel(f,s)).addEventListener("id",function(e){g.has(e.message)?w.default.warning("Channel already exists",e.message):g.set(e.message,u)}),(y=u).addEventListener("ended",function(){y=null}),"function"==typeof WebTransport&&d.webTransportUrl&&(_=new I.QuicConnection(d.webTransportUrl,e.webTransportToken,P(),f.webTransportConfiguration));var s,u,c=new x.ConferenceInfo(e.room.id,Array.from(v.values()),Array.from(m.values()),p);_?_.init().then(function(){l(c)}):l(c)},function(e){b=D,t(new k.ConferenceError(e))})))})},this.publish=function(e,t,r){return e instanceof j.LocalStream?e.source.data?_.publish(e):n.has(e.mediaStream.id)?Promise.reject(new k.ConferenceError("Cannot publish a published stream.")):y.publish(e,t,r):Promise.reject(new k.ConferenceError("Invalid stream."))},this.subscribe=function(e,t){return e instanceof j.RemoteStream?e.source.data?e.source.audio||e.source.video?Promise.reject(new TypeError("Invalid source info. A remote stream is either a data stream or a media stream.")):_?_.subscribe(e):Promise.reject(new TypeError("WebTransport is not supported.")):y.subscribe(e,t):Promise.reject(new k.ConferenceError("Invalid stream."))},this.send=function(e,t){return r("text",{to:t=void 0===t?"all":t,message:e})},this.leave=function(){return a.disconnect().then(function(){o(),b=D})},I.QuicConnection&&(this.createSendStream=(0,u.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=2;break}throw new k.ConferenceError("No QUIC connection available.");case 2:return e.abrupt("return",_.createSendStream());case 3:case"end":return e.stop()}},e)})))}},{"../base/base64.js":25,"../base/event.js":27,"../base/logger.js":29,"../base/stream.js":34,"../base/utils.js":36,"./channel.js":37,"./error.js":39,"./info.js":41,"./mixedstream.js":42,"./participant.js":43,"./quicconnection.js":44,"./signaling.js":45,"./streamutils.js":46,"@babel/runtime/helpers/asyncToGenerator":4,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/typeof":21,"@babel/runtime/regenerator":24}],39:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.ConferenceError=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/inherits")),s=n(e("@babel/runtime/helpers/possibleConstructorReturn")),u=n(e("@babel/runtime/helpers/getPrototypeOf"));function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(r);return e=n?(e=(0,u.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,s.default)(this,e)}}n=function(e){(0,o.default)(r,e);var t=c(r);function r(e){return(0,a.default)(this,r),t.call(this,e)}return(0,i.default)(r)}((0,n(e("@babel/runtime/helpers/wrapNativeSuper")).default)(Error));r.ConferenceError=n},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/wrapNativeSuper":23}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ConferenceClient",{enumerable:!0,get:function(){return n.ConferenceClient}}),Object.defineProperty(r,"SioSignaling",{enumerable:!0,get:function(){return i.SioSignaling}});var n=e("./client.js"),i=e("./signaling.js")},{"./client.js":38,"./signaling.js":45}],41:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.ConferenceInfo=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck"));r.ConferenceInfo=(0,i.default)(function e(t,r,n,i){(0,a.default)(this,e),this.id=t,this.participants=r,this.remoteStreams=n,this.self=i})},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/interopRequireDefault":10}],42:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RemoteMixedStream=r.LayoutChangeEvent=r.ActiveAudioInputChangeEvent=void 0,n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),s=n(e("@babel/runtime/helpers/inherits")),u=n(e("@babel/runtime/helpers/possibleConstructorReturn")),c=n(e("@babel/runtime/helpers/getPrototypeOf")),l=p(e("../base/stream.js")),d=p(e("./streamutils.js")),n=e("../base/event.js");function f(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(f=function(e){return e?r:t})(e))}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=f(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(r);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,e)}}e=function(e){(0,s.default)(n,e);var r=h(n);function n(e){var t;if((0,a.default)(this,n),"mixed"!==e.type)throw new TypeError("Not a mixed stream");return(t=r.call(this,e.id,void 0,void 0,new l.StreamSourceInfo("mixed","mixed"))).settings=d.convertToPublicationSettings(e.media),t.extraCapabilities=d.convertToSubscriptionCapabilities(e.media),t}return(0,i.default)(n)}(l.RemoteStream),r.RemoteMixedStream=e,e=function(e){(0,s.default)(n,e);var r=h(n);function n(e,t){return(0,a.default)(this,n),(e=r.call(this,e)).activeAudioInputStreamId=t.activeAudioInputStreamId,e}return(0,i.default)(n)}(n.OwtEvent),r.ActiveAudioInputChangeEvent=e,e=function(e){(0,s.default)(n,e);var r=h(n);function n(e,t){return(0,a.default)(this,n),(e=r.call(this,e)).layout=t.layout,e}return(0,i.default)(n)}(n.OwtEvent);r.LayoutChangeEvent=e},{"../base/event.js":27,"../base/stream.js":34,"./streamutils.js":46,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/typeof":21}],43:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),s=(Object.defineProperty(r,"__esModule",{value:!0}),r.Participant=void 0,n(e("@babel/runtime/helpers/createClass"))),u=n(e("@babel/runtime/helpers/classCallCheck")),c=n(e("@babel/runtime/helpers/assertThisInitialized")),l=n(e("@babel/runtime/helpers/inherits")),i=n(e("@babel/runtime/helpers/possibleConstructorReturn")),a=n(e("@babel/runtime/helpers/getPrototypeOf"));function d(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(d=function(e){return e?r:t})(e))}function f(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,a.default)(r);return e=n?(e=(0,a.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,i.default)(this,e)}}n=function(e){(0,l.default)(a,e);var i=f(a);function a(e,t,r){var n;return(0,u.default)(this,a),n=i.call(this),Object.defineProperty((0,c.default)(n),"id",{configurable:!1,writable:!1,value:e}),Object.defineProperty((0,c.default)(n),"role",{configurable:!1,writable:!1,value:t}),Object.defineProperty((0,c.default)(n),"userId",{configurable:!1,writable:!1,value:r}),n}return(0,s.default)(a)}(function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=d(t);if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var a;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("../base/event.js")).EventDispatcher);r.Participant=n},{"../base/event.js":27,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/typeof":21}],44:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),l=(Object.defineProperty(r,"__esModule",{value:!0}),r.QuicConnection=void 0,n(e("@babel/runtime/regenerator"))),d=n(e("@babel/runtime/helpers/asyncToGenerator")),f=n(e("@babel/runtime/helpers/classCallCheck")),p=n(e("@babel/runtime/helpers/createClass")),h=n(e("@babel/runtime/helpers/inherits")),i=n(e("@babel/runtime/helpers/possibleConstructorReturn")),a=n(e("@babel/runtime/helpers/getPrototypeOf")),b=n(e("../base/logger.js")),n=e("../base/event.js"),m=e("../base/publication.js"),v=e("./subscription.js"),g=e("../base/base64.js");function y(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?s(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,a.default)(r);return e=n?(e=(0,a.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,i.default)(this,e)}}e=function(e){(0,h.default)(c,e);var t,r,n,i,a,o,s,u=_(c);function c(e,t,r,n){var i;return(0,f.default)(this,c),(i=u.call(this))._tokenString=t,i._token=JSON.parse(g.Base64.decodeBase64(t)),i._signaling=r,i._ended=!1,i._quicStreams=new Map,i._quicTransport=new WebTransport(e,n),i._subscribePromises=new Map,i._transportId=i._token.transportId,i._initReceiveStreamReader(),i}return(0,p.default)(c,[{key:"onMessage",value:function(e,t){switch(e){case"progress":"soac"===t.status?this._soacHandler(t.data):"ready"===t.status?this._readyHandler():"error"===t.status&&this._errorHandler(t.data);break;case"stream":this._onStreamEvent(t);break;default:b.default.warning("Unknown notification from MCU.")}}},{key:"init",value:(s=(0,d.default)(l.default.mark(function e(){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._authenticate(this._tokenString);case 2:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"_initReceiveStreamReader",value:(o=(0,d.default)(l.default.mark(function e(){var t,r,n,i,a,o,s,u;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this._quicTransport.incomingBidirectionalStreams.getReader(),b.default.info("Reader: "+t),r=!1;case 3:if(r){e.next=31;break}return e.next=6,t.read();case 6:if(a=e.sent,n=a.value,a=a.done,b.default.info("New stream received"),a)return r=!0,e.abrupt("break",31);e.next=13;break;case 13:return i=n.readable.getReader(),e.next=16,i.read();case 16:if(a=e.sent,o=a.value,a.done)return b.default.error("Stream closed unexpectedly."),e.abrupt("return");e.next=22;break;case 22:if(16!=o.length)return b.default.error("Unexpected length for UUID."),e.abrupt("return");e.next=25;break;case 25:i.releaseLock(),s=this._uint8ArrayToUuid(o),this._quicStreams.set(s,n),this._subscribePromises.has(s)&&(u=this._createSubscription(s,n),this._subscribePromises.get(s).resolve(u)),e.next=3;break;case 31:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"_createSubscription",value:function(e,t){e=new v.Subscription(e,function(){t.abortReading()});return e.stream=t,e}},{key:"_authenticate",value:(a=(0,d.default)(l.default.mark(function e(t){var r,n,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._quicTransport.ready;case 2:return e.next=4,this._quicTransport.createBidirectionalStream();case 4:return n=e.sent,r=n.readable.getReader(),n=n.writable.getWriter(),e.next=9,n.ready;case 9:return n.write(new Uint8Array(16)),i=new TextEncoder,i=i.encode(t),n.write(Uint32Array.of(i.length)),n.write(i),e.next=16,r.read();case 16:b.default.info("Authentication success.");case 17:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"createSendStream",value:(i=(0,d.default)(l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._quicTransport.ready;case 2:return e.next=4,this._quicTransport.createBidirectionalStream();case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"createSendStream1",value:(n=(0,d.default)(l.default.mark(function e(t){var r,n,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b.default.info("Create stream."),e.next=3,this._quicTransport.ready;case 3:return e.next=5,this._initiatePublication();case 5:return r=e.sent,e.next=8,this._quicTransport.createSendStream();case 8:return n=e.sent,i=n.writable.getWriter(),e.next=12,i.ready;case 12:return i.write(this._uuidToUint8Array(r)),i.releaseLock(),this._quicStreams.set(r,n),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"publish",value:(r=(0,d.default)(l.default.mark(function e(t){var r,n,i,a,o=this;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initiatePublication();case 2:return r=e.sent,n=t.stream,i=n.writable.getWriter(),e.next=7,i.ready;case 7:return i.write(this._uuidToUint8Array(r)),i.releaseLock(),b.default.info("publish id"),this._quicStreams.set(r,n),a=new m.Publication(r,function(){o._signaling.sendSignalingMessage("unpublish",{id:a}).catch(function(e){b.default.warning("MCU returns negative ack for unpublishing, "+e)})}),e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"hasContentSessionId",value:function(e){return this._quicStreams.has(e)}},{key:"_uuidToUint8Array",value:function(e){if(32!=e.length)throw new TypeError("Incorrect UUID.");for(var t=new Uint8Array(16),r=0;r<16;r++)t[r]=parseInt(e.substring(2*r,2*r+2),16);return t}},{key:"_uint8ArrayToUuid",value:function(e){var t,r="",n=y(e);try{for(n.s();!(t=n.n()).done;)r+=t.value.toString(16).padStart(2,"0")}catch(e){n.e(e)}finally{n.f()}return r}},{key:"subscribe",value:function(e){var i=this;return new Promise(function(r,n){i._signaling.sendSignalingMessage("subscribe",{media:null,data:{from:e.id},transport:{type:"quic",id:i._transportId}}).then(function(e){var t;i._quicStreams.has(e.id)?(t=i._createSubscription(e.id,i._quicStreams.get(e.id)),r(t)):(i._quicStreams.set(e.id,null),i._subscribePromises.set(e.id,{resolve:r,reject:n}))})})}},{key:"_readAndPrint",value:function(){var t=this;this._quicStreams[0].waitForReadable(5).then(function(){var e=new Uint8Array(t._quicStreams[0].readBufferedAmount);t._quicStreams[0].readInto(e),b.default.info("Read data: "+e),t._readAndPrint()})}},{key:"_initiatePublication",value:(t=(0,d.default)(l.default.mark(function e(){var t;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._signaling.sendSignalingMessage("publish",{media:null,data:!0,transport:{type:"quic",id:this._transportId}});case 2:if(t=e.sent,this._transportId!==t.transportId)throw new Error("Transport ID not match.");e.next=5;break;case 5:return e.abrupt("return",t.id);case 6:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_readyHandler",value:function(){}}]),c}(n.EventDispatcher);r.QuicConnection=e},{"../base/base64.js":25,"../base/event.js":27,"../base/logger.js":29,"../base/publication.js":32,"./subscription.js":47,"@babel/runtime/helpers/asyncToGenerator":4,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/regenerator":24}],45:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.SioSignaling=void 0,n(e("@babel/runtime/helpers/classCallCheck"))),a=n(e("@babel/runtime/helpers/createClass")),s=n(e("@babel/runtime/helpers/inherits")),u=n(e("@babel/runtime/helpers/possibleConstructorReturn")),c=n(e("@babel/runtime/helpers/getPrototypeOf")),l=n(e("../base/logger.js")),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=h(t);if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var a;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("../base/event.js")),f=e("./error.js"),p=e("../base/base64.js");function h(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(h=function(e){return e?r:t})(e))}function b(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(r);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,u.default)(this,e)}}function m(e,t,r,n){"ok"===e||"success"===e?r(t):"error"===e?n(t):l.default.error("MCU returns unknown ack.")}n=function(e){(0,s.default)(r,e);var t=b(r);function r(){var e;return(0,i.default)(this,r),(e=t.call(this))._socket=null,e._loggedIn=!1,e._reconnectTimes=0,e._reconnectionTicket=null,e._refreshReconnectionTicket=null,e}return(0,a.default)(r,[{key:"connect",value:function(t,e,i){var a=this;return new Promise(function(r,n){a._socket=io(t,{reconnection:!0,reconnectionAttempts:10,"force new connection":!0}),["participant","text","stream","progress"].forEach(function(t){a._socket.on(t,function(e){a.dispatchEvent(new d.MessageEvent("data",{message:{notification:t,data:e}}))})}),a._socket.on("reconnecting",function(){a._reconnectTimes++}),a._socket.on("reconnect_failed",function(){10<=a._reconnectTimes&&a.dispatchEvent(new d.OwtEvent("disconnect"))}),a._socket.on("connect_error",function(e){n("connect_error:".concat(t))}),a._socket.on("drop",function(){a._reconnectTimes=10}),a._socket.on("disconnect",function(){a._clearReconnectionTask(),10<=a._reconnectTimes&&(a._loggedIn=!1,a.dispatchEvent(new d.OwtEvent("disconnect")))}),a._socket.emit("login",i,function(e,t){"ok"===e&&(a._loggedIn=!0,a._onReconnectionTicket(t.reconnectionTicket),a._socket.on("connect",function(){a._socket.emit("relogin",a._reconnectionTicket,function(e,t){"ok"===e?(a._reconnectTimes=0,a._onReconnectionTicket(t)):a.dispatchEvent(new d.OwtEvent("disconnect"))})})),m(e,t,r,n)})})}},{key:"disconnect",value:function(){var i=this;return!this._socket||this._socket.disconnected?Promise.reject(new f.ConferenceError("Portal is not connected.")):new Promise(function(r,n){i._socket.emit("logout",function(e,t){i._reconnectTimes=10,i._socket.disconnect(),m(e,t,r,n)})})}},{key:"send",value:function(e,t){var i=this;return new Promise(function(r,n){i._socket.emit(e,t,function(e,t){m(e,t,r,n)})})}},{key:"_onReconnectionTicket",value:function(e){var t,r=this,e=(this._reconnectionTicket=e,JSON.parse(p.Base64.decodeBase64(e))),n=Date.now();e.notAfter<=n-1e4?l.default.warning("Reconnection ticket expires too soon."):((t=e.notAfter-n-6e4)<0&&(t=e.notAfter-n-1e4),this._clearReconnectionTask(),this._refreshReconnectionTicket=setTimeout(function(){r._socket.emit("refreshReconnectionTicket",function(e,t){"ok"!==e?l.default.warning("Failed to refresh reconnection ticket."):r._onReconnectionTicket(t)})},t))}},{key:"_clearReconnectionTask",value:function(){clearTimeout(this._refreshReconnectionTicket),this._refreshReconnectionTicket=null}}]),r}(d.EventDispatcher);r.SioSignaling=n},{"../base/base64.js":25,"../base/event.js":27,"../base/logger.js":29,"./error.js":39,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/typeof":21}],46:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),b=(Object.defineProperty(r,"__esModule",{value:!0}),r.convertToPublicationSettings=function(e){var t,r,n,i,a,o,s,u,c=[],l=[],d=k(e.tracks);try{for(d.s();!(u=d.n()).done;){var f,p,h=u.value;"audio"===h.type?(h.format&&(t=new P.AudioCodecParameters(h.format.codec,h.format.channelNum,h.format.sampleRate)),(f=new b.AudioPublicationSettings(t))._trackId=h.id,c.push(f)):"video"===h.type&&(h.format&&(r=new P.VideoCodecParameters(h.format.codec,h.format.profile)),h.parameters&&(h.parameters.resolution&&(n=new S.Resolution(h.parameters.resolution.width,h.parameters.resolution.height)),i=h.parameters.framerate,a=1e3*h.parameters.bitrate,o=h.parameters.keyFrameInterval),h.rid&&(s=h.rid),(p=new b.VideoPublicationSettings(r,n,i,a,o,s))._trackId=h.id,l.push(p))}}catch(e){d.e(e)}finally{d.f()}return new b.PublicationSettings(c,l)},r.convertToSubscriptionCapabilities=function(e){var t,r,n,i,a=k(e.tracks);try{for(a.s();!(n=a.n()).done;){var o=n.value;if("audio"===o.type){var s=[];if(o.optional&&o.optional.format){var u,c=k(o.optional.format);try{for(c.s();!(u=c.n()).done;){var l=u.value,d=new P.AudioCodecParameters(l.codec,l.channelNum,l.sampleRate);s.push(d)}}catch(e){c.e(e)}finally{c.f()}}s.sort(),t=new w.AudioSubscriptionCapabilities(s)}else if("video"===o.type){var f,p,h,b,m=[];if(o.optional&&o.optional.format){var v,g=k(o.optional.format);try{for(g.s();!(v=g.n()).done;){var y=v.value,_=new P.VideoCodecParameters(y.codec,y.profile);m.push(_)}}catch(e){g.e(e)}finally{g.f()}}m.sort(),r=null!=(i=o.optional)&&i.parameters?((f=Array.from(o.optional.parameters.resolution,function(e){return new S.Resolution(e.width,e.height)})).sort(j),(p=Array.from(o.optional.parameters.bitrate,function(e){return"string"==typeof(e=e)&&e.startsWith("x")?Number.parseFloat(e.replace(/^x/,"")):(C.default.warning("Invalid bitrate multiplier input."),0)})).push(1),p.sort(E),(h=JSON.parse(JSON.stringify(o.optional.parameters.framerate))).sort(E),(b=JSON.parse(JSON.stringify(o.optional.parameters.keyFrameInterval))).sort(E),new w.VideoSubscriptionCapabilities(m,f,h,p,b)):new w.VideoSubscriptionCapabilities(m,[],[],[],[])}}}catch(e){a.e(e)}finally{a.f()}return new w.SubscriptionCapabilities(t,r)},i(e("../base/publication.js"))),S=i(e("../base/mediaformat.js")),P=i(e("../base/codec.js")),w=i(e("./subscription.js")),C=n(e("../base/logger.js"));function s(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(s=function(e){return e?r:t})(e))}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function k(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?u(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t){return e-t}function j(e,t){return e.width!==t.width?e.width-t.width:e.height-t.height}},{"../base/codec.js":26,"../base/logger.js":29,"../base/mediaformat.js":30,"../base/publication.js":32,"./subscription.js":47,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/typeof":21}],47:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),d=(Object.defineProperty(r,"__esModule",{value:!0}),r.VideoSubscriptionUpdateOptions=r.VideoSubscriptionConstraints=r.VideoSubscriptionCapabilities=r.SubscriptionUpdateOptions=r.SubscriptionCapabilities=r.Subscription=r.SubscribeOptions=r.AudioSubscriptionConstraints=r.AudioSubscriptionCapabilities=void 0,n(e("@babel/runtime/helpers/assertThisInitialized"))),i=n(e("@babel/runtime/helpers/inherits")),a=n(e("@babel/runtime/helpers/possibleConstructorReturn")),o=n(e("@babel/runtime/helpers/getPrototypeOf")),s=n(e("@babel/runtime/helpers/createClass")),f=n(e("@babel/runtime/helpers/classCallCheck")),n=e("../base/event.js");function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,o.default)(r);return e=n?(e=(0,o.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,a.default)(this,e)}}r.AudioSubscriptionCapabilities=(0,s.default)(function e(t){(0,f.default)(this,e),this.codecs=t});e=(0,s.default)(function e(t,r,n,i,a){(0,f.default)(this,e),this.codecs=t,this.resolutions=r,this.frameRates=n,this.bitrateMultipliers=i,this.keyFrameIntervals=a}),r.VideoSubscriptionCapabilities=e,e=(0,s.default)(function e(t,r){(0,f.default)(this,e),this.audio=t,this.video=r}),r.SubscriptionCapabilities=e,e=(0,s.default)(function e(t){(0,f.default)(this,e),this.codecs=t}),r.AudioSubscriptionConstraints=e,e=(0,s.default)(function e(t,r,n,i,a,o){(0,f.default)(this,e),this.codecs=t,this.resolution=r,this.frameRate=n,this.bitrateMultiplier=i,this.keyFrameInterval=a,this.rid=o}),r.VideoSubscriptionConstraints=e,e=(0,s.default)(function e(t,r,n){(0,f.default)(this,e),this.audio=t,this.video=r,this.transport=n}),r.SubscribeOptions=e,e=(0,s.default)(function e(){(0,f.default)(this,e),this.resolution=void 0,this.frameRate=void 0,this.bitrateMultipliers=void 0,this.keyFrameInterval=void 0}),r.VideoSubscriptionUpdateOptions=e,e=(0,s.default)(function e(){(0,f.default)(this,e),this.video=void 0}),r.SubscriptionUpdateOptions=e,e=function(e){(0,i.default)(l,e);var c=u(l);function l(e,t,r,n,i,a,o,s){var u;if((0,f.default)(this,l),u=c.call(this),e)return Object.defineProperty((0,d.default)(u),"id",{configurable:!1,writable:!1,value:e}),Object.defineProperty((0,d.default)(u),"stream",{configurable:!1,writable:!0,value:t}),Object.defineProperty((0,d.default)(u),"transport",{configurable:!1,writable:!1,value:r}),u.stop=n,u.getStats=i,u.mute=a,u.unmute=o,u.applyOptions=s,u._audioTrackId=void 0,u._videoTrackId=void 0,u;throw new TypeError("ID cannot be null or undefined.")}return(0,s.default)(l)}(n.EventDispatcher);r.Subscription=e},{"../base/event.js":27,"@babel/runtime/helpers/assertThisInitialized":3,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15}],48:[function(e,t,r){"use strict";var o=e("@babel/runtime/helpers/typeof"),n=(Object.defineProperty(r,"__esModule",{value:!0}),r.P2P=r.Conference=r.Base=void 0,a(e("./base/export.js"))),i=a(e("./p2p/export.js")),e=a(e("./conference/export.js"));function s(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(s=function(e){return e?r:t})(e))}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}r.Base=n;n=i,r.P2P=n,i=e;r.Conference=i},{"./base/export.js":28,"./conference/export.js":40,"./p2p/export.js":50,"@babel/runtime/helpers/typeof":21}],49:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.errors=r.P2PError=void 0,r.getErrorByCode=function(e){return{2100:l.P2P_CONN_SERVER_UNKNOWN,2101:l.P2P_CONN_SERVER_UNAVAILABLE,2102:l.P2P_CONN_SERVER_BUSY,2103:l.P2P_CONN_SERVER_NOT_SUPPORTED,2110:l.P2P_CONN_CLIENT_UNKNOWN,2111:l.P2P_CONN_CLIENT_NOT_INITIALIZED,2120:l.P2P_CONN_AUTH_UNKNOWN,2121:l.P2P_CONN_AUTH_FAILED,2201:l.P2P_MESSAGING_TARGET_UNREACHABLE,2400:l.P2P_CLIENT_UNKNOWN,2401:l.P2P_CLIENT_UNSUPPORTED_METHOD,2402:l.P2P_CLIENT_ILLEGAL_ARGUMENT,2403:l.P2P_CLIENT_INVALID_STATE,2404:l.P2P_CLIENT_NOT_ALLOWED,2500:l.P2P_WEBRTC_UNKNOWN,2501:l.P2P_WEBRTC_SDP}[e]},n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/inherits")),s=n(e("@babel/runtime/helpers/possibleConstructorReturn")),u=n(e("@babel/runtime/helpers/getPrototypeOf")),n=n(e("@babel/runtime/helpers/wrapNativeSuper"));function c(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,u.default)(r);return e=n?(e=(0,u.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,s.default)(this,e)}}var l={P2P_CONN_SERVER_UNKNOWN:{code:2100,message:"Server unknown error."},P2P_CONN_SERVER_UNAVAILABLE:{code:2101,message:"Server is unavaliable."},P2P_CONN_SERVER_BUSY:{code:2102,message:"Server is too busy."},P2P_CONN_SERVER_NOT_SUPPORTED:{code:2103,message:"Method has not been supported by server."},P2P_CONN_CLIENT_UNKNOWN:{code:2110,message:"Client unknown error."},P2P_CONN_CLIENT_NOT_INITIALIZED:{code:2111,message:"Connection is not initialized."},P2P_CONN_AUTH_UNKNOWN:{code:2120,message:"Authentication unknown error."},P2P_CONN_AUTH_FAILED:{code:2121,message:"Wrong username or token."},P2P_MESSAGING_TARGET_UNREACHABLE:{code:2201,message:"Remote user cannot be reached."},P2P_CLIENT_DENIED:{code:2202,message:"User is denied."},P2P_CLIENT_UNKNOWN:{code:2400,message:"Unknown errors."},P2P_CLIENT_UNSUPPORTED_METHOD:{code:2401,message:"This method is unsupported in current browser."},P2P_CLIENT_ILLEGAL_ARGUMENT:{code:2402,message:"Illegal argument."},P2P_CLIENT_INVALID_STATE:{code:2403,message:"Invalid peer state."},P2P_CLIENT_NOT_ALLOWED:{code:2404,message:"Remote user is not allowed."},P2P_WEBRTC_UNKNOWN:{code:2500,message:"WebRTC error."},P2P_WEBRTC_SDP:{code:2502,message:"SDP error."}};r.errors=l;e=function(e){(0,o.default)(n,e);var r=c(n);function n(e,t){return(0,a.default)(this,n),(t=r.call(this,t)).code="number"==typeof e?e:e.code,t}return(0,i.default)(n)}((0,n.default)(Error));r.P2PError=e},{"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/wrapNativeSuper":23}],50:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"P2PClient",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(r,"P2PError",{enumerable:!0,get:function(){return a.P2PError}}),n(e("./p2pclient.js"))),a=e("./error.js")},{"./error.js":49,"./p2pclient.js":51,"@babel/runtime/helpers/interopRequireDefault":10}],51:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),p=(Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,n(e("../base/logger.js"))),h=e("../base/event.js"),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var a;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r])}n.default=e,t&&t.set(e,n);return n}(e("./error.js")),m=n(e("./peerconnection-channel.js"));function s(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(s=function(e){return e?r:t})(e))}var v=1,g=2,y=3;r.default=function(e,t){Object.setPrototypeOf(this,new h.EventDispatcher);var n,i=e,a=t,o=new Map,s=new Map,u=this,c=v,l=(a.onMessage=function(e,t){p.default.debug("Received signaling message from "+e+": "+t);var t=JSON.parse(t),r=t.connectionId;u.allowedRemoteIds.indexOf(e)<0?l(e,t.connectionId,"chat-closed",b.errors.P2P_CLIENT_DENIED):s.has(e)&&s.get(e)!==r&&!d(e)?p.default.warning("Collision detected, ignore this message because current endpoint is impolite peer."):"chat-closed"===t.type?o.has(e)&&(f(e,r).onMessage(t),o.delete(e)):f(e,r).onMessage(t)},a.onServerDisconnected=function(){c=v,u.dispatchEvent(new h.OwtEvent("serverdisconnected"))},this.allowedRemoteIds=[],this.connect=function(e){return c!==v?(p.default.warning("Invalid connection state: "+c),Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_INVALID_STATE))):(c=g,new Promise(function(t,r){a.connect(e).then(function(e){c=y,t(n=e)},function(e){r(new b.P2PError(b.getErrorByCode(e)))})}))},this.disconnect=function(){c!=v&&(o.forEach(function(e){e.stop()}),o.clear(),a.disconnect())},this.publish=function(e,t){return c!==y?Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_INVALID_STATE,"P2P Client is not connected to signaling channel.")):this.allowedRemoteIds.indexOf(e)<0?Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_NOT_ALLOWED)):Promise.resolve(f(e).publish(t))},this.send=function(e,t){return c!==y?Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_INVALID_STATE,"P2P Client is not connected to signaling channel.")):this.allowedRemoteIds.indexOf(e)<0?Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_NOT_ALLOWED)):Promise.resolve(f(e).send(t))},this.stop=function(e){o.has(e)?(o.get(e).stop(),o.delete(e)):p.default.warning("No PeerConnection between current endpoint and specific remote endpoint.")},this.getStats=function(e){return o.has(e)?o.get(e).getStats():Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_INVALID_STATE,"No PeerConnection between current endpoint and specific remote endpoint."))},this.getPeerConnection=function(e){return o.has(e)?o.get(e).peerConnection:Promise.reject(new b.P2PError(b.errors.P2P_CLIENT_INVALID_STATE,"No PeerConnection between current endpoint and specific remote endpoint."))},function(e,t,r,n){r={type:r,connectionId:t};return n&&(r.data=n),a.send(e,JSON.stringify(r)).catch(function(e){if("number"==typeof e)throw b.getErrorByCode(e)})}),d=function(e){return n<e},f=function(e,t){var r;return!t&&s.has(e)&&(t=s.get(e)),s.has(e)&&s.get(e)!=t&&u.stop(e),t||(t=Math.round(1e5*Math.random())),s.set(e,t),o.has(e)||((r=Object.create(h.EventDispatcher)).sendSignalingMessage=l,(t=new m.default(i,n,e,t,r)).addEventListener("streamadded",function(e){u.dispatchEvent(e)}),t.addEventListener("messagereceived",function(e){u.dispatchEvent(e)}),t.addEventListener("ended",function(){o.has(e)&&o.delete(e),s.delete(e)}),o.set(e,t)),o.get(e)}}},{"../base/event.js":27,"../base/logger.js":29,"./error.js":49,"./peerconnection-channel.js":52,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/typeof":21}],52:[function(e,N,t){"use strict";var r=e("@babel/runtime/helpers/interopRequireDefault"),o=e("@babel/runtime/helpers/typeof"),f=(Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.P2PPeerConnectionChannelEvent=void 0,r(e("@babel/runtime/helpers/slicedToArray"))),n=r(e("@babel/runtime/helpers/typeof")),i=r(e("@babel/runtime/helpers/createClass")),u=r(e("@babel/runtime/helpers/classCallCheck")),a=r(e("@babel/runtime/helpers/inherits")),s=r(e("@babel/runtime/helpers/possibleConstructorReturn")),c=r(e("@babel/runtime/helpers/getPrototypeOf")),l=r(e("@babel/runtime/helpers/wrapNativeSuper")),p=r(e("../base/logger.js")),h=e("../base/event.js"),b=e("../base/publication.js"),d=S(e("../base/utils.js")),m=S(e("./error.js")),v=S(e("../base/stream.js")),g=S(e("../base/sdputils.js")),y=e("../base/transport.js");function _(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_=function(e){return e?r:t})(e))}function S(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};t=_(t);if(t&&t.has(e))return t.get(e);var r,n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}function P(e,t){var r,n,i,a,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return n=!(r=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){n=!0,i=e},f:function(){try{r||null==o.return||o.return()}finally{if(n)throw i}}};if(Array.isArray(e)||(o=function(e,t){var r;if(e)return"string"==typeof e?w(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,c.default)(r);return e=n?(e=(0,c.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,s.default)(this,e)}}r=function(e){(0,a.default)(n,e);var r=C(n);function n(e){var t;return(0,u.default)(this,n),(t=r.call(this,e)).stream=e.stream,t}return(0,i.default)(n)}((0,l.default)(Event));t.P2PPeerConnectionChannelEvent=r;var k="message",E="chat-closed",j="chat-track-sources",O="chat-stream-info",x="chat-signal",T="chat-tracks-added",I="chat-tracks-removed",R="chat-data-received",M="chat-ua",A=d.sysInfo(),e=function(e){(0,a.default)(s,e);var o=C(s);function s(e,t,r,n,i){var a;return(0,u.default)(this,s),(a=o.call(this))._config=e,a._remoteId=r,a._connectionId=n,a._signaling=i,a._pc=null,a._publishedStreams=new Map,a._pendingStreams=[],a._publishingStreams=[],a._pendingUnpublishStreams=[],a._remoteStreamInfo=new Map,a._remoteStreams=[],a._remoteTrackSourceInfo=new Map,a._publishPromises=new Map,a._unpublishPromises=new Map,a._publishingStreamTracks=new Map,a._publishedStreamTracks=new Map,a._isNegotiationNeeded=!1,a._remoteSideSupportsRemoveStream=!0,a._remoteSideIgnoresDataChannelAcks=!1,a._remoteIceCandidates=[],a._dataChannels=new Map,a._pendingMessages=[],a._dataSeq=1,a._sendDataPromises=new Map,a._addedTrackIds=[],a._isPolitePeer=t<r,a._settingLocalSdp=!1,a._settingRemoteSdp=!1,a._disposed=!1,a._createPeerConnection(),a._sendUa(A),a}return(0,i.default)(s,[{key:"peerConnection",get:function(){return this._pc}},{key:"publish",value:function(n){var i=this;return n instanceof v.LocalStream?this._publishedStreams.has(n)?Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_ILLEGAL_ARGUMENT,"Duplicated stream.")):this._areAllTracksEnded(n.mediaStream)?Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_INVALID_STATE,"All tracks are ended.")):this._sendStreamInfo(n).then(function(){return new Promise(function(e,t){i._addStream(n.mediaStream),i._publishingStreams.push(n);var r=Array.from(n.mediaStream.getTracks(),function(e){return e.id});i._publishingStreamTracks.set(n.mediaStream.id,r),i._publishPromises.set(n.mediaStream.id,{resolve:e,reject:t})})}):Promise.reject(new TypeError("Invalid stream."))}},{key:"send",value:function(e){var r,n=this;return"string"!=typeof e?Promise.reject(new TypeError("Invalid message.")):(r={id:this._dataSeq++,data:e},this._dataChannels.has(k)||this._createDataChannel(k),"open"===this._dataChannels.get(k).readyState?(this._dataChannels.get(k).send(JSON.stringify(r)),Promise.resolve()):(this._pendingMessages.push(r),new Promise(function(e,t){n._sendDataPromises.set(r.id,{resolve:e,reject:t})})))}},{key:"stop",value:function(){this._stop(void 0,!0)}},{key:"getStats",value:function(e){var r,t=this;return this._pc?void 0===e?this._pc.getStats():(r=[],Promise.all([e.getTracks().forEach(function(e){t._getStats(e,r)})]).then(function(){return new Promise(function(e,t){e(r)})})):Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_INVALID_STATE))}},{key:"_getStats",value:function(e,t){return this._pc.getStats(e).then(function(e){t.push(e)})}},{key:"_addStream",value:function(e){var t,r=P(e.getTracks());try{for(r.s();!(t=r.n()).done;){var n=t.value;this._pc.addTransceiver(n,{direction:"sendonly",streams:[e]})}}catch(e){r.e(e)}finally{r.f()}}},{key:"onMessage",value:function(e){this._SignalingMesssageHandler(e)}},{key:"_sendSdp",value:function(e){return this._signaling.sendSignalingMessage(this._remoteId,this._connectionId,x,e)}},{key:"_sendUa",value:function(e){e={sdk:e.sdk,capabilities:e.capabilities};this._sendSignalingMessage(M,e)}},{key:"_sendSignalingMessage",value:function(e,t){return this._signaling.sendSignalingMessage(this._remoteId,this._connectionId,e,t)}},{key:"_SignalingMesssageHandler",value:function(e){switch(p.default.debug("Channel received message: "+e),e.type){case M:this._handleRemoteCapability(e.data);break;case j:this._trackSourcesHandler(e.data);break;case O:this._streamInfoHandler(e.data);break;case x:this._sdpHandler(e.data);break;case T:this._tracksAddedHandler(e.data);break;case I:this._tracksRemovedHandler(e.data);break;case R:this._dataReceivedHandler(e.data);break;case E:this._chatClosedHandler(e.data);break;default:p.default.error("Invalid signaling message received. Type: "+e.type)}}},{key:"_tracksAddedHandler",value:function(e){var t,f=this,r=P(e);try{var n=function(){var d=t.value;f._publishingStreamTracks.forEach(function(u,c){for(var l=0;l<u.length;l++)!function(){if(u[l]===d&&(f._publishedStreamTracks.has(c)||f._publishedStreamTracks.set(c,[]),f._publishedStreamTracks.get(c).push(u[l]),u.splice(l,1)),0==u.length){if(!f._publishPromises.has(c))return p.default.warning("Cannot find the promise for publishing "+c);var e,t=f._publishingStreams.findIndex(function(e){return e.mediaStream.id==c}),r=f._publishingStreams[t],n=(f._publishingStreams.splice(t,1),new y.TransportSettings(y.TransportType.WEBRTC,void 0)),i=(n.rtpTransceivers=[],P(f._pc.getTransceivers()));try{for(i.s();!(e=i.n()).done;){var a,o=e.value;(null==(a=o.sender)?void 0:a.track)in f._publishedStreamTracks.get(c)&&n.rtpTransceivers.push(o)}}catch(e){i.e(e)}finally{i.f()}var s=new b.Publication(d,n,function(){f._unpublish(r).then(function(){s.dispatchEvent(new h.OwtEvent("ended"))},function(e){p.default.debug("Something wrong happened during stopping a publication. "+e.message)})},function(){return r&&r.mediaStream?f.getStats(r.mediaStream):Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_INVALID_STATE,"Publication is not available."))});f._publishedStreams.set(r,s),f._publishPromises.get(c).resolve(s),f._publishPromises.delete(c)}}()})};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}},{key:"_tracksRemovedHandler",value:function(e){var t,r=this,n=P(e);try{for(n.s();!(t=n.n()).done;)!function(){var n=t.value;r._publishedStreamTracks.forEach(function(e,t){for(var r=0;r<e.length;r++)e[r]===n&&e.splice(r,1)})}()}catch(e){n.e(e)}finally{n.f()}}},{key:"_dataReceivedHandler",value:function(e){this._sendDataPromises.has(e)?this._sendDataPromises.get(e).resolve():p.default.warning("Received unknown data received message. ID: "+e)}},{key:"_sdpHandler",value:function(e){"offer"===e.type?this._onOffer(e):"answer"===e.type?this._onAnswer(e):"candidates"===e.type&&this._onRemoteIceCandidate(e)}},{key:"_trackSourcesHandler",value:function(e){var t,r=P(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._remoteTrackSourceInfo.set(n.id,n.source)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_streamInfoHandler",value:function(e){e?this._remoteStreamInfo.set(e.id,{source:e.source,attributes:e.attributes,stream:null,mediaStream:null,trackIds:e.tracks}):p.default.warning("Unexpected stream info.")}},{key:"_chatClosedHandler",value:function(e){this._disposed=!0,this._stop(e,!1)}},{key:"_onOffer",value:function(e){var t=this;if(p.default.debug("About to set remote description. Signaling state: "+this._pc.signalingState),"stable"!==this._pc.signalingState||this._settingLocalSdp){if(!this._isPolitePeer)return void p.default.debug("Collision detected. Ignore this offer.");p.default.debug("Rollback."),this._settingLocalSdp=!0,this._pc.setLocalDescription().then(function(){t._settingLocalSdp=!1})}e.sdp=this._setRtpSenderOptions(e.sdp,this._config);e=new RTCSessionDescription(e);this._settingRemoteSdp=!0,this._pc.setRemoteDescription(e).then(function(){t._settingRemoteSdp=!1,t._createAndSendAnswer()},function(e){p.default.debug("Set remote description failed. Message: "+e.message),t._stop(e,!0)})}},{key:"_onAnswer",value:function(e){var t=this,e=(p.default.debug("About to set remote description. Signaling state: "+this._pc.signalingState),e.sdp=this._setRtpSenderOptions(e.sdp,this._config),new RTCSessionDescription(e));this._settingRemoteSdp=!0,this._pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){p.default.debug("Set remote descripiton successfully."),t._settingRemoteSdp=!1,t._drainPendingMessages()},function(e){p.default.debug("Set remote description failed. Message: "+e.message),t._stop(e,!0)})}},{key:"_onLocalIceCandidate",value:function(e){e.candidate?this._sendSdp({type:"candidates",candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}).catch(function(e){p.default.warning("Failed to send candidate.")}):p.default.debug("Empty candidate.")}},{key:"_onRemoteTrackAdded",value:function(e){p.default.debug("Remote track added.");var t,r=P(e.streams);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!this._remoteStreamInfo.has(n.id))return void p.default.warning("Missing stream info.");this._remoteStreamInfo.get(n.id).stream||this._setStreamToRemoteStreamInfo(n)}}catch(e){r.e(e)}finally{r.f()}"connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState?this._checkIceConnectionStateAndFireEvent():this._addedTrackIds.concat(e.track.id)}},{key:"_onRemoteStreamAdded",value:function(t){var e,r;p.default.debug("Remote stream added."),this._remoteStreamInfo.has(t.stream.id)?("connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState?this._sendSignalingMessage(T,this._remoteStreamInfo.get(t.stream.id).trackIds):this._addedTrackIds=this._addedTrackIds.concat(this._remoteStreamInfo.get(t.stream.id).trackIds),e=this._remoteStreamInfo.get(t.stream.id).source.audio,r=this._remoteStreamInfo.get(t.stream.id).source.video,e=new v.StreamSourceInfo(e,r),d.isSafari()&&(e.audio||t.stream.getAudioTracks().forEach(function(e){t.stream.removeTrack(e)}),e.video||t.stream.getVideoTracks().forEach(function(e){t.stream.removeTrack(e)})),r=this._remoteStreamInfo.get(t.stream.id).attributes,(e=new v.RemoteStream(void 0,this._remoteId,t.stream,e,r))&&(this._remoteStreams.push(e),r=new v.StreamEvent("streamadded",{stream:e}),this.dispatchEvent(r))):p.default.warning("Cannot find source info for stream "+t.stream.id)}},{key:"_onRemoteStreamRemoved",value:function(t){p.default.debug("Remote stream removed.");var e,r=this._remoteStreams.findIndex(function(e){return e.mediaStream.id===t.stream.id});-1!==r&&(e=this._remoteStreams[r],this._streamRemoved(e),this._remoteStreams.splice(r,1))}},{key:"_onNegotiationneeded",value:function(){"stable"!==this._pc.signalingState||this._pc._settingLocalSdp||this._settingRemoteSdp?this._isNegotiationNeeded=!0:this._doNegotiate()}},{key:"_onRemoteIceCandidate",value:function(e){e=new RTCIceCandidate({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex});this._pc.remoteDescription&&""!==this._pc.remoteDescription.sdp?(p.default.debug("Add remote ice candidates."),this._pc.addIceCandidate(e).catch(function(e){p.default.warning("Error processing ICE candidate: "+e)})):(p.default.debug("Cache remote ice candidates."),this._remoteIceCandidates.push(e))}},{key:"_onSignalingStateChange",value:function(e){p.default.debug("Signaling state changed: "+this._pc.signalingState),"have-remote-offer"!==this._pc.signalingState&&"stable"!==this._pc.signalingState||this._drainPendingRemoteIceCandidates(),"stable"===this._pc.signalingState&&(this._negotiating=!1,this._isNegotiationNeeded?this._onNegotiationneeded():(this._drainPendingStreams(),this._drainPendingMessages()))}},{key:"_onIceConnectionStateChange",value:function(e){var t;"closed"===e.currentTarget.iceConnectionState||"failed"===e.currentTarget.iceConnectionState?(t=new m.P2PError(m.errors.P2P_WEBRTC_UNKNOWN,"ICE connection failed or closed."),this._stop(t,!0)):"connected"!==e.currentTarget.iceConnectionState&&"completed"!==e.currentTarget.iceConnectionState||(this._sendSignalingMessage(T,this._addedTrackIds),this._addedTrackIds=[],this._checkIceConnectionStateAndFireEvent())}},{key:"_onDataChannelMessage",value:function(e){e=JSON.parse(e.data),this._remoteSideIgnoresDataChannelAcks||this._sendSignalingMessage(R,e.id),e=new h.MessageEvent("messagereceived",{message:e.data,origin:this._remoteId});this.dispatchEvent(e)}},{key:"_onDataChannelOpen",value:function(e){p.default.debug("Data Channel is opened."),e.target.label===k&&(p.default.debug("Data channel for messages is opened."),this._drainPendingMessages())}},{key:"_onDataChannelClose",value:function(e){p.default.debug("Data Channel is closed.")}},{key:"_streamRemoved",value:function(e){this._remoteStreamInfo.has(e.mediaStream.id)||p.default.warning("Cannot find stream info."),this._sendSignalingMessage(I,this._remoteStreamInfo.get(e.mediaStream.id).trackIds);var t=new h.OwtEvent("ended");e.dispatchEvent(t)}},{key:"_createPeerConnection",value:function(){var t=this,e=this._config.rtcConfiguration||{};this._pc=new RTCPeerConnection(e),this._pc.ontrack=function(e){t._onRemoteTrackAdded.apply(t,[e])},this._pc.onicecandidate=function(e){t._onLocalIceCandidate.apply(t,[e])},this._pc.onsignalingstatechange=function(e){t._onSignalingStateChange.apply(t,[e])},this._pc.ondatachannel=function(e){p.default.debug("On data channel."),t._dataChannels.has(e.channel.label)||(t._dataChannels.set(e.channel.label,e.channel),p.default.debug("Save remote created data channel.")),t._bindEventsToDataChannel(e.channel)},this._pc.oniceconnectionstatechange=function(e){t._onIceConnectionStateChange.apply(t,[e])},this._pc.onnegotiationneeded=function(){t._onNegotiationneeded()}}},{key:"_drainPendingStreams",value:function(){if(p.default.debug("Draining pending streams."),this._pc&&"stable"===this._pc.signalingState){p.default.debug("Peer connection is ready for draining pending streams.");for(var e=0;e<this._pendingStreams.length;e++){var t=this._pendingStreams[e];this._pendingStreams.shift(),t.mediaStream&&(this._addStream(t.mediaStream),p.default.debug("Added stream to peer connection."),this._publishingStreams.push(t))}this._pendingStreams.length=0;var r,n=P(this._pendingUnpublishStreams);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.stream){if("function"==typeof this._pc.getTransceivers&&"function"==typeof this._pc.removeTrack){var a,o=P(this._pc.getTransceivers());try{for(o.s();!(a=o.n()).done;){var s,u=a.value,c=P(i.stream.getTracks());try{for(c.s();!(s=c.n()).done;){var l=s.value;u.sender.track==l&&("sendonly"===u.direction?u.stop():this._pc.removeTrack(l))}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}}else p.default.debug("getSender or removeTrack is not supported, fallback to removeStream."),this._pc.removeStream(i.stream);this._unpublishPromises.get(i.stream.id).resolve(),this._publishedStreams.delete(i)}}}catch(e){n.e(e)}finally{n.f()}this._pendingUnpublishStreams.length=0}}},{key:"_drainPendingRemoteIceCandidates",value:function(){for(var e=0;e<this._remoteIceCandidates.length;e++)p.default.debug("Add candidate"),this._pc.addIceCandidate(this._remoteIceCandidates[e]).catch(function(e){p.default.warning("Error processing ICE candidate: "+e)});this._remoteIceCandidates.length=0}},{key:"_drainPendingMessages",value:function(){if(p.default.debug("Draining pending messages."),0!=this._pendingMessages.length){var e=this._dataChannels.get(k);if(e&&"open"===e.readyState){for(var t=0;t<this._pendingMessages.length;t++){p.default.debug("Sending message via data channel: "+this._pendingMessages[t]),e.send(JSON.stringify(this._pendingMessages[t]));var r=this._pendingMessages[t].id;this._sendDataPromises.has(r)&&this._sendDataPromises.get(r).resolve()}this._pendingMessages.length=0}else this._pc&&"closed"!==this._pc.connectionState&&!e&&this._createDataChannel(k)}}},{key:"_sendStreamInfo",value:function(t){var r;return t&&t.mediaStream?(r=[],t.mediaStream.getTracks().map(function(e){r.push({id:e.id,source:t.source[e.kind]})}),Promise.all([this._sendSignalingMessage(j,r),this._sendSignalingMessage(O,{id:t.mediaStream.id,attributes:t.attributes,tracks:Array.from(r,function(e){return e.id}),source:t.source})])):new m.P2PError(m.errors.P2P_CLIENT_ILLEGAL_ARGUMENT)}},{key:"_handleRemoteCapability",value:function(e){e.sdk&&e.sdk&&"JavaScript"===e.sdk.type&&e.runtime&&"Firefox"===e.runtime.name?this._remoteSideSupportsRemoveStream=!1:this._remoteSideSupportsRemoveStream=!0,e.capabilities&&(this._remoteSideIgnoresDataChannelAcks=e.capabilities.ignoreDataChannelAcks)}},{key:"_doNegotiate",value:function(){this._createAndSendOffer()}},{key:"_setCodecOrder",value:function(e){var t;return this._config.audioEncodings&&(t=Array.from(this._config.audioEncodings,function(e){return e.codec.name}),e=g.reorderCodecs(e,"audio",t)),this._config.videoEncodings&&(t=Array.from(this._config.videoEncodings,function(e){return e.codec.name}),e=g.reorderCodecs(e,"video",t)),e}},{key:"_setMaxBitrate",value:function(e,t){return"object"===(0,n.default)(t.audioEncodings)&&(e=g.setMaxBitrate(e,t.audioEncodings)),e="object"===(0,n.default)(t.videoEncodings)?g.setMaxBitrate(e,t.videoEncodings):e}},{key:"_setRtpSenderOptions",value:function(e,t){return e=this._setMaxBitrate(e,t)}},{key:"_setRtpReceiverOptions",value:function(e){return e=this._setCodecOrder(e)}},{key:"_createAndSendOffer",value:function(){var t=this;this._pc?(this._isNegotiationNeeded=!1,this._pc.createOffer().then(function(e){if(e.sdp=t._setRtpReceiverOptions(e.sdp),"stable"===t._pc.signalingState&&!t._settingLocalSdp&&!t._settingRemoteSdp)return t._settingLocalSdp=!0,t._pc.setLocalDescription(e).then(function(){return t._settingLocalSdp=!1,t._sendSdp(t._pc.localDescription)})}).catch(function(e){p.default.error(e.message);e=new m.P2PError(m.errors.P2P_WEBRTC_SDP,e.message);t._stop(e,!0)})):p.default.error("Peer connection have not been created.")}},{key:"_createAndSendAnswer",value:function(){var t=this;this._drainPendingStreams(),this._isNegotiationNeeded=!1,this._pc.createAnswer().then(function(e){return e.sdp=t._setRtpReceiverOptions(e.sdp),t._logCurrentAndPendingLocalDescription(),t._settingLocalSdp=!0,t._pc.setLocalDescription(e).then(function(){t._settingLocalSdp=!1})}).then(function(){return t._sendSdp(t._pc.localDescription)}).catch(function(e){p.default.error(e.message+" Please check your codec settings.");e=new m.P2PError(m.errors.P2P_WEBRTC_SDP,e.message);t._stop(e,!0)})}},{key:"_logCurrentAndPendingLocalDescription",value:function(){p.default.info("Current description: "+this._pc.currentLocalDescription),p.default.info("Pending description: "+this._pc.pendingLocalDescription)}},{key:"_getAndDeleteTrackSourceInfo",value:function(e){if(0<e.length){var t,e=e[0].id;if(this._remoteTrackSourceInfo.has(e))return t=this._remoteTrackSourceInfo.get(e),this._remoteTrackSourceInfo.delete(e),t;p.default.warning("Cannot find source info for "+e)}}},{key:"_unpublish",value:function(r){var n=this;return navigator.mozGetUserMedia||!this._remoteSideSupportsRemoveStream?(p.default.error("Stopping a publication is not supported on Firefox. Please use P2PClient.stop() to stop the connection with remote endpoint."),Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_UNSUPPORTED_METHOD))):this._publishedStreams.has(r)?(this._pendingUnpublishStreams.push(r),new Promise(function(e,t){n._unpublishPromises.set(r.mediaStream.id,{resolve:e,reject:t}),n._drainPendingStreams()})):Promise.reject(new m.P2PError(m.errors.P2P_CLIENT_ILLEGAL_ARGUMENT))}},{key:"_createDataChannel",value:function(e){this._dataChannels.has(e)?p.default.warning("Data channel labeled "+e+" already exists."):this._pc?(p.default.debug("Create data channel."),e=this._pc.createDataChannel(e),this._bindEventsToDataChannel(e),this._dataChannels.set(k,e)):p.default.debug("PeerConnection is not available before creating DataChannel.")}},{key:"_bindEventsToDataChannel",value:function(e){var t=this;e.onmessage=function(e){t._onDataChannelMessage.apply(t,[e])},e.onopen=function(e){t._onDataChannelOpen.apply(t,[e])},e.onclose=function(e){t._onDataChannelClose.apply(t,[e])},e.onerror=function(e){p.default.debug("Data Channel Error: "+e)}}},{key:"_getStreamByTrack",value:function(e){var t,r=[],n=P(this._remoteStreamInfo);try{for(n.s();!(t=n.n()).done;){var i=(0,f.default)(t.value,2)[1];if(i.stream&&i.stream.mediaStream){var a,o=P(i.stream.mediaStream.getTracks());try{for(o.s();!(a=o.n()).done;)e===a.value&&r.push(i.stream.mediaStream)}catch(e){o.e(e)}finally{o.f()}}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"_areAllTracksEnded",value:function(e){var t,r=P(e.getTracks());try{for(r.s();!(t=r.n()).done;)if("live"===t.value.readyState)return!1}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"_stop",value:function(e,t){var r,n=(n=e)||new m.P2PError(m.errors.P2P_CLIENT_UNKNOWN),i=P(this._dataChannels);try{for(i.s();!(r=i.n()).done;)(0,f.default)(r.value,2)[1].close()}catch(e){i.e(e)}finally{i.f()}this._dataChannels.clear(),this._pc&&"closed"!==this._pc.iceConnectionState&&this._pc.close();var a,o=P(this._publishPromises);try{for(o.s();!(a=o.n()).done;)(0,f.default)(a.value,2)[1].reject(n)}catch(e){o.e(e)}finally{o.f()}this._publishPromises.clear();var s,u=P(this._unpublishPromises);try{for(u.s();!(s=u.n()).done;)(0,f.default)(s.value,2)[1].reject(n)}catch(e){u.e(e)}finally{u.f()}this._unpublishPromises.clear();var c,l,d=P(this._sendDataPromises);try{for(d.s();!(c=d.n()).done;)(0,f.default)(c.value,2)[1].reject(n)}catch(e){d.e(e)}finally{d.f()}this._sendDataPromises.clear(),this._publishedStreams.forEach(function(e){e.dispatchEvent(new h.OwtEvent("ended"))}),this._publishedStreams.clear(),this._remoteStreams.forEach(function(e){e.dispatchEvent(new h.OwtEvent("ended"))}),this._remoteStreams=[],this._disposed||(t&&(e&&((l=JSON.parse(JSON.stringify(e))).message="Error happened at remote side."),this._sendSignalingMessage(E,l).catch(function(e){p.default.debug("Failed to send close."+e.message)})),this.dispatchEvent(new Event("ended")))}},{key:"_setStreamToRemoteStreamInfo",value:function(e){var t=this._remoteStreamInfo.get(e.id),r=t.attributes,n=new v.StreamSourceInfo(this._remoteStreamInfo.get(e.id).source.audio,this._remoteStreamInfo.get(e.id).source.video),n=(t.stream=new v.RemoteStream(void 0,this._remoteId,e,n,r),t.mediaStream=e,t.stream);n?this._remoteStreams.push(n):p.default.warning("Failed to create RemoteStream.")}},{key:"_checkIceConnectionStateAndFireEvent",value:function(){var i=this;if("connected"===this._pc.iceConnectionState||"completed"===this._pc.iceConnectionState){var e,t=P(this._remoteStreamInfo);try{for(t.s();!(e=t.n()).done;){var r=(0,f.default)(e.value,2)[1];if(r.mediaStream){var n,a=new v.StreamEvent("streamadded",{stream:r.stream}),o=P(r.mediaStream.getTracks());try{for(o.s();!(n=o.n()).done;)n.value.addEventListener("ended",function(e){var t,r=P(i._getStreamByTrack(e.target));try{for(r.s();!(t=r.n()).done;){var n=t.value;i._areAllTracksEnded(n)&&i._onRemoteStreamRemoved({stream:n})}}catch(e){r.e(e)}finally{r.f()}})}catch(e){o.e(e)}finally{o.f()}this._sendSignalingMessage(T,r.trackIds),this._remoteStreamInfo.get(r.mediaStream.id).mediaStream=null,this.dispatchEvent(a)}}}catch(e){t.e(e)}finally{t.f()}}}}]),s}(h.EventDispatcher);t.default=e},{"../base/event.js":27,"../base/logger.js":29,"../base/publication.js":32,"../base/sdputils.js":33,"../base/stream.js":34,"../base/transport.js":35,"../base/utils.js":36,"./error.js":49,"@babel/runtime/helpers/classCallCheck":5,"@babel/runtime/helpers/createClass":7,"@babel/runtime/helpers/getPrototypeOf":8,"@babel/runtime/helpers/inherits":9,"@babel/runtime/helpers/interopRequireDefault":10,"@babel/runtime/helpers/possibleConstructorReturn":15,"@babel/runtime/helpers/slicedToArray":18,"@babel/runtime/helpers/typeof":21,"@babel/runtime/helpers/wrapNativeSuper":23}]},{},[48])(48)});